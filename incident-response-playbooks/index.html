
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A comprehensive security guide and toolkit for Google Workspace, Google Cloud Platform, and other Google products">
      
      
        <meta name="author" content="Google Security Research Team">
      
      
        <link rel="canonical" href="https://ethanolivertroy.github.io/Goog-Sec/incident-response-playbooks/">
      
      
        <link rel="prev" href="../google-groups-security/">
      
      
        <link rel="next" href="../log-analysis/">
      
      
      <link rel="icon" href="/assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Incident Response Playbooks - Google Security Suite</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#google-workspace-incident-response-playbooks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Google Security Suite" class="md-header__button md-logo" aria-label="Google Security Suite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 6c1.4 0 2.8 1.1 2.8 2.5V11c.6 0 1.2.6 1.2 1.3v3.5c0 .6-.6 1.2-1.3 1.2H9.2c-.6 0-1.2-.6-1.2-1.3v-3.5c0-.6.6-1.2 1.2-1.2V9.5C9.2 8.1 10.6 7 12 7m0 1.2c-.8 0-1.5.5-1.5 1.3V11h3V9.5c0-.8-.7-1.3-1.5-1.3"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Google Security Suite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Incident Response Playbooks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ethanolivertroy/Goog-Sec" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Goog-Sec
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../workspace/" class="md-tabs__link">
          
  
  
    
  
  Google Workspace Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../gcp/" class="md-tabs__link">
          
  
  
    
  
  Google Cloud Platform Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../chrome/" class="md-tabs__link">
          
  
  
    
  
  Google Chrome Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../cross-product/" class="md-tabs__link">
          
  
  
    
  
  Cross-Product Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../nist-fedramp/" class="md-tabs__link">
          
  
  
    
  
  NIST/FedRAMP Controls

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../resources/" class="md-tabs__link">
        
  
  
    
  
  Resources

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../contributing/documentation-guidelines/" class="md-tabs__link">
          
  
  
    
  
  Contributing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Google Security Suite" class="md-nav__button md-logo" aria-label="Google Security Suite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 6c1.4 0 2.8 1.1 2.8 2.5V11c.6 0 1.2.6 1.2 1.3v3.5c0 .6-.6 1.2-1.3 1.2H9.2c-.6 0-1.2-.6-1.2-1.3v-3.5c0-.6.6-1.2 1.2-1.2V9.5C9.2 8.1 10.6 7 12 7m0 1.2c-.8 0-1.5.5-1.5 1.3V11h3V9.5c0-.8-.7-1.3-1.5-1.3"/></svg>

    </a>
    Google Security Suite
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ethanolivertroy/Goog-Sec" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Goog-Sec
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../workspace/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Google Workspace Security
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Google Workspace Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core Security Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Core Security Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Protection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Email Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoint-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Endpoint Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../drive-document-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drive & Document Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../threat-hunting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Hunting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../detection-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Detection Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security-checklists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Checklists
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Advanced Security Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Security Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps-script-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apps Script Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../attack-vectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attack Vectors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exploitation-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exploitation Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-groups-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Google Groups Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Incident Response Playbooks
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Incident Response Playbooks
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#playbook-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Playbook Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#account-compromise-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Account Compromise Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Account Compromise Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detection-and-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containment-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      Containment Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eradication-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Eradication Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery Guidance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-incident-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Incident Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exfiltration-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Data Exfiltration Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Exfiltration Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detection-and-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containment-procedures_1" class="md-nav__link">
    <span class="md-ellipsis">
      Containment Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eradication-steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Eradication Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-guidance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery Guidance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-incident-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Incident Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth-token-abuse-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth Token Abuse Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OAuth Token Abuse Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-overview_2" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detection-and-analysis_2" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containment-procedures_2" class="md-nav__link">
    <span class="md-ellipsis">
      Containment Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eradication-steps_2" class="md-nav__link">
    <span class="md-ellipsis">
      Eradication Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-guidance_2" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery Guidance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-incident-analysis_2" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Incident Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-privilege-escalation-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Admin Privilege Escalation Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Admin Privilege Escalation Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-overview_3" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detection-and-analysis_3" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containment-procedures_3" class="md-nav__link">
    <span class="md-ellipsis">
      Containment Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eradication-steps_3" class="md-nav__link">
    <span class="md-ellipsis">
      Eradication Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-guidance_3" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery Guidance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-incident-analysis_3" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Incident Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#malicious-application-installation-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      Malicious Application Installation Incident Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Malicious Application Installation Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-overview_4" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detection-and-analysis_4" class="md-nav__link">
    <span class="md-ellipsis">
      Detection and Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containment-procedures_4" class="md-nav__link">
    <span class="md-ellipsis">
      Containment Procedures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eradication-steps_4" class="md-nav__link">
    <span class="md-ellipsis">
      Eradication Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-guidance_4" class="md-nav__link">
    <span class="md-ellipsis">
      Recovery Guidance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-incident-analysis_4" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Incident Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources-and-references" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources and References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Resources and References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#incident-response-documentation-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Incident Response Documentation Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-workspace-security-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Google Workspace Security Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Log Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../marketplace-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Marketplace Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../msp-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSP Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oauth-token-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OAuth Token Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../organizational-units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Organizational Units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pentesting-insights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pentesting Insights
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vulnerability-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vulnerability Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executive-dashboards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Executive Dashboards
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../gcp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Google Cloud Platform Security
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Google Cloud Platform Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity & Access Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/network-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/compute-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compute Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/storage-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage & Database Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kubernetes & Container Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes & Container Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/container-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../gcp/gke/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Google Kubernetes Engine (GKE)
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6_2" id="__nav_3_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_2">
            <span class="md-nav__icon md-icon"></span>
            Google Kubernetes Engine (GKE)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/gke/fips-compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FIPS 140-2 Compliance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/logging-monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud Logging & Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/security-command-center/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Command Center
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/saif-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI/ML Security (SAIF)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compliance & Regulatory Controls
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../chrome/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Google Chrome Security
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Google Chrome Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/chrome-enterprise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chrome Enterprise
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/policy-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/extension-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extension Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/web-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication & SSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chrome/zero-trust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zero Trust Browsing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../cross-product/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cross-Product Security
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Cross-Product Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/identity-federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity Federation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/zero-trust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zero Trust Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/security-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/threat-intelligence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threat Intelligence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compliance Management
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../nist-fedramp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    NIST/FedRAMP Controls
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            NIST/FedRAMP Controls
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Google Cloud Platform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Google Cloud Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nist-fedramp/gcp/access-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Access Control (AC)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nist-fedramp/gcp/configuration-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Management (CM)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nist-fedramp/gcp/identification-authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identification & Authentication (IA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nist-fedramp/gcp/system-communications-protection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System & Communications Protection (SC)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nist-fedramp/gcp/system-information-integrity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System & Information Integrity (SI)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../nist-fedramp/workspace/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Google Workspace
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Google Workspace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/documentation-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/code-blocks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Block Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/plugin-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugin Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/ethanolivertroy/Goog-Sec/edit/main/docs/incident-response-playbooks.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/ethanolivertroy/Goog-Sec/raw/main/docs/incident-response-playbooks.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<div class="admonition warning">
<p class="admonition-title">Under Construction</p>
<p>This page is under construction. Please check back later for comprehensive guidance</p>
</div>
<h1 id="google-workspace-incident-response-playbooks">Google Workspace Incident Response Playbooks<a class="headerlink" href="#google-workspace-incident-response-playbooks" title="Permanent link">&para;</a></h1>
<p>This document provides comprehensive incident response playbooks for Google Workspace security incidents. These playbooks include detection, investigation, containment, eradication, recovery, and post-incident analysis phases for common Google Workspace security incidents.</p>
<h2 id="playbook-structure">Playbook Structure<a class="headerlink" href="#playbook-structure" title="Permanent link">&para;</a></h2>
<p>Each incident response playbook follows a standardized structure:</p>
<ol>
<li><strong>Incident Overview</strong></li>
<li>Description and potential impact</li>
<li>Common attack vectors and indicators</li>
<li>
<p>Severity classification</p>
</li>
<li>
<p><strong>Detection and Analysis</strong></p>
</li>
<li>Initial indicators and alerts</li>
<li>Investigation procedures</li>
<li>
<p>Evidence collection guidance</p>
</li>
<li>
<p><strong>Containment Procedures</strong></p>
</li>
<li>Immediate containment actions</li>
<li>Secondary containment measures</li>
<li>
<p>Limiting incident spread</p>
</li>
<li>
<p><strong>Eradication Steps</strong></p>
</li>
<li>Removing attacker access</li>
<li>Eliminating persistence mechanisms</li>
<li>
<p>Validating complete removal</p>
</li>
<li>
<p><strong>Recovery Guidance</strong></p>
</li>
<li>Service restoration</li>
<li>Security posture strengthening</li>
<li>
<p>Return to normal operations</p>
</li>
<li>
<p><strong>Post-Incident Analysis</strong></p>
</li>
<li>Root cause identification</li>
<li>Lessons learned documentation</li>
<li>Security improvements implementation</li>
</ol>
<h2 id="account-compromise-incident-response">Account Compromise Incident Response<a class="headerlink" href="#account-compromise-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="incident-overview">Incident Overview<a class="headerlink" href="#incident-overview" title="Permanent link">&para;</a></h3>
<p><strong>Description:</strong><br />
Unauthorized access to one or more Google Workspace user accounts, potentially resulting in data theft, further access, or destructive actions.</p>
<p><strong>Common Attack Vectors:</strong>
- Phishing campaigns targeting credentials
- Password spraying or brute force attacks
- OAuth token theft/abuse
- Session hijacking
- Recovery email/phone compromise</p>
<p><strong>Severity Classifications:</strong>
- <strong>Critical</strong>: Admin account, executive, or multiple user compromises
- <strong>High</strong>: Single user with access to sensitive data
- <strong>Medium</strong>: Single user with limited access
- <strong>Low</strong>: Service account with minimal permissions</p>
<h3 id="detection-and-analysis">Detection and Analysis<a class="headerlink" href="#detection-and-analysis" title="Permanent link">&para;</a></h3>
<p><strong>Initial Indicators:</strong>
- Unusual login locations, times, or devices
- Suspicious email forwarding rules or filters
- Unexpected OAuth application authorizations
- Unusual file access or download patterns
- Password reset or recovery setting changes</p>
<p><strong>Investigation Procedures:</strong></p>
<ol>
<li>
<p><strong>Login Activity Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Login
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>- Filter for affected user(s)
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>- Identify suspicious login events (locations, devices, times)
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>- Check access methods (browser, IMAP, API, mobile)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>- Verify if 2FA challenges succeeded or failed
</span></code></pre></div></p>
</li>
<li>
<p><strong>Account Setting Changes</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Account
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>- Identify changes to recovery information
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>- Check password reset activities
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>- Verify 2FA enrollment or configuration changes
</span></code></pre></div></p>
</li>
<li>
<p><strong>Email Configuration Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Email logs
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>- Check for newly created email filters
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>- Identify email forwarding rules
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>- Look for delegation settings changes
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Application Assessment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Token
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>- Review recently authorized applications
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>- Check for suspicious or unusual permissions
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>- Verify application usage patterns
</span></code></pre></div></p>
</li>
<li>
<p><strong>User Activity Timeline Construction</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Python script to create comprehensive user activity timeline</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_user_activity_timeline</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">user_email</span><span class="p">,</span> <span class="n">days_back</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a timeline of all user activities across Google Workspace&quot;&quot;&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="c1"># Calculate start time (days back from now)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_back</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="c1"># Applications to query</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">applications</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;user_accounts&#39;</span><span class="p">,</span> 
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>                    <span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;gmail&#39;</span><span class="p">,</span> <span class="s1">&#39;gcp&#39;</span><span class="p">]</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">all_activities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="c1"># Collect activities across all applications</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">applications</span><span class="p">:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>                <span class="n">userKey</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>                <span class="n">applicationName</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>                <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>                <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>            <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>            
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="k">if</span> <span class="s1">&#39;items&#39;</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>                    <span class="c1"># Extract basic event info</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>                    <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>                        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>                        <span class="s1">&#39;application&#39;</span><span class="p">:</span> <span class="n">app</span><span class="p">,</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>                        <span class="s1">&#39;event_name&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>                        <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>                        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{}</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>                    <span class="p">}</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>                    
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>                    <span class="c1"># Extract parameters</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>                    <span class="n">parameters</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>                        <span class="n">event</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>                    
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>                    <span class="n">all_activities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error collecting </span><span class="si">{</span><span class="n">app</span><span class="si">}</span><span class="s2"> activities: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>    
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>    <span class="c1"># Sort all activities by timestamp</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>    <span class="n">all_activities</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>    
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>    <span class="k">return</span> <span class="n">all_activities</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Evidence Collection</strong></p>
</li>
<li>Capture screenshots of suspicious activities</li>
<li>Export relevant logs for preservation</li>
<li>Document all detected indicators</li>
<li>Record incident timeline based on evidence</li>
</ol>
<h3 id="containment-procedures">Containment Procedures<a class="headerlink" href="#containment-procedures" title="Permanent link">&para;</a></h3>
<p><strong>Immediate Actions:</strong></p>
<ol>
<li>
<p><strong>Account Suspension</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Admin Console &gt; Directory &gt; Users
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>- Locate compromised user(s)
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>- Click &quot;More&quot; &gt; &quot;Suspend user&quot;
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>- Document time of suspension
</span></code></pre></div></p>
</li>
<li>
<p><strong>Password Reset</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Admin Console &gt; Directory &gt; Users
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>- Select compromised user(s)
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>- Click &quot;Reset password&quot;
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>- Force password change at next login
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>- Uncheck &quot;Send email with reset instructions&quot;
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Token Revocation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Admin Console &gt; Security &gt; API Controls &gt; Domain-wide delegation
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>- Identify and remove suspicious delegations
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>- Review and revoke access for suspicious applications
</span></code></pre></div></p>
</li>
<li>
<p><strong>Session Termination</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Admin Console &gt; Directory &gt; Users &gt; [User] &gt; &quot;Security&quot;
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>- Scroll to &quot;Your devices&quot;
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>- Click &quot;Sign out of all sessions&quot;
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Secondary Containment:</strong></p>
<ol>
<li>
<p><strong>Email Security Measures</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Admin Console &gt; Apps &gt; Google Workspace &gt; Gmail &gt; Safety
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>- Implement temporary email quarantine for affected user(s)
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>- Configure additional message scanning
</span></code></pre></div></p>
</li>
<li>
<p><strong>Access Restrictions</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>Admin Console &gt; Directory &gt; Users &gt; [User] &gt; &quot;Security&quot;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>- Configure login restrictions (IP, device)
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>- Implement geographic login constraints
</span></code></pre></div></p>
</li>
<li>
<p><strong>Document Access Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a># Via Google Drive audit log analysis
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>- Identify documents shared externally
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>- Review sensitive content access
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>- Temporarily restrict sharing capabilities
</span></code></pre></div></p>
</li>
<li>
<p><strong>Group Membership Assessment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>Admin Console &gt; Directory &gt; Groups
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>- Review and adjust group memberships
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>- Remove from privileged groups temporarily
</span></code></pre></div></p>
</li>
</ol>
<h3 id="eradication-steps">Eradication Steps<a class="headerlink" href="#eradication-steps" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Email Configuration Cleanup</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a># Manual or via API
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>- Remove unauthorized email forwarding
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>- Delete suspicious email filters
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>- Revoke unauthorized mail delegation
</span></code></pre></div></li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Python script to identify and remove suspicious email configurations</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">cleanup_suspicious_email_configs</span><span class="p">(</span><span class="n">admin_service</span><span class="p">,</span> <span class="n">gmail_service</span><span class="p">,</span> <span class="n">user_email</span><span class="p">):</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove suspicious email configurations&quot;&quot;&quot;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">cleanup_report</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        <span class="s1">&#39;forwarding_removed&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="s1">&#39;filters_removed&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        <span class="s1">&#39;delegates_removed&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="p">}</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>        <span class="c1"># Check and remove suspicious forwarding</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">forwarding</span> <span class="o">=</span> <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">getForwarding</span><span class="p">(</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>            <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        <span class="k">if</span> <span class="n">forwarding</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_authorized_forwarding</span><span class="p">(</span><span class="n">forwarding</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forwardingEmail&#39;</span><span class="p">)):</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>            <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">updateForwarding</span><span class="p">(</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>                <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>                <span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>            <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>            <span class="n">cleanup_report</span><span class="p">[</span><span class="s1">&#39;forwarding_removed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forwarding</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forwardingEmail&#39;</span><span class="p">))</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="c1"># Check and remove suspicious filters</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">filters</span> <span class="o">=</span> <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">filters</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>            <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        <span class="k">for</span> <span class="n">filter_data</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>            <span class="k">if</span> <span class="n">is_suspicious_filter</span><span class="p">(</span><span class="n">filter_data</span><span class="p">):</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>                <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">filters</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>                    <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">filter_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>                <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>                <span class="n">cleanup_report</span><span class="p">[</span><span class="s1">&#39;filters_removed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filter_data</span><span class="p">)</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>        
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>        <span class="c1"># Check and remove unauthorized delegates</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>        <span class="n">delegates</span> <span class="o">=</span> <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">delegates</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>            <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>        
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>        <span class="k">for</span> <span class="n">delegate</span> <span class="ow">in</span> <span class="n">delegates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delegates&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_authorized_delegate</span><span class="p">(</span><span class="n">delegate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delegateEmail&#39;</span><span class="p">)):</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>                <span class="n">gmail_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span><span class="o">.</span><span class="n">delegates</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>                    <span class="n">userId</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>                    <span class="n">delegateEmail</span><span class="o">=</span><span class="n">delegate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delegateEmail&#39;</span><span class="p">)</span>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>                <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>                <span class="n">cleanup_report</span><span class="p">[</span><span class="s1">&#39;delegates_removed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delegate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delegateEmail&#39;</span><span class="p">))</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>                
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>        <span class="k">return</span> <span class="n">cleanup_report</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>    
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="c1"># Helper functions</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_authorized_forwarding</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if email is in allowed forwarding list&quot;&quot;&quot;</span>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>    <span class="c1"># Replace with your organization&#39;s logic</span>
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a>    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;company.com&#39;</span><span class="p">,</span> <span class="s1">&#39;trusted-partner.com&#39;</span><span class="p">]</span>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">domain</span><span class="p">)</span> <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">allowed_domains</span><span class="p">)</span>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_suspicious_filter</span><span class="p">(</span><span class="n">filter_data</span><span class="p">):</span>
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a filter appears suspicious&quot;&quot;&quot;</span>
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>    <span class="c1"># Look for common suspicious patterns</span>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>    <span class="k">if</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">filter_data</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>        
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">term</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">filter_data</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> 
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>           <span class="p">[</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;verification&#39;</span><span class="p">,</span> <span class="s1">&#39;authenticate&#39;</span><span class="p">]):</span>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>        
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>    <span class="c1"># Add additional detection logic as needed</span>
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>    <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>    
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_authorized_delegate</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if delegate is authorized&quot;&quot;&quot;</span>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>    <span class="c1"># Replace with your organization&#39;s logic</span>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a>    <span class="n">authorized_delegates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admin@company.com&#39;</span><span class="p">,</span> <span class="s1">&#39;executive-assistant@company.com&#39;</span><span class="p">]</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>    <span class="k">return</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">authorized_delegates</span>
</span></code></pre></div>
<ol>
<li>
<p><strong>2FA Reset and Reconfiguration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Admin Console &gt; Directory &gt; Users &gt; [User] &gt; &quot;Security&quot;
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>- Reset 2FA enrollment
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>- Force new 2FA enrollment
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>- Verify backup codes are regenerated
</span></code></pre></div></p>
</li>
<li>
<p><strong>Recovery Method Verification</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Admin Console &gt; Directory &gt; Users &gt; [User] &gt; &quot;Account&quot;
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>- Verify and update recovery email
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>- Verify and update recovery phone
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>- Ensure all recovery methods are legitimate
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Access Review and Cleanup</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a># For each affected user
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>- Revoke access for all unauthorized applications
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>- Document authorized applications for restoration
</span></code></pre></div></p>
</li>
<li>
<p><strong>Permission Verification</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a># For each affected user
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>- Review admin role assignments
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>- Verify appropriate group memberships
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>- Check service account permissions
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>- Validate resource-specific access rights
</span></code></pre></div></p>
</li>
</ol>
<h3 id="recovery-guidance">Recovery Guidance<a class="headerlink" href="#recovery-guidance" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Account Restoration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Admin Console &gt; Directory &gt; Users
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>- Unsuspend affected user(s)
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>- Verify account settings are correct
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>- Restore appropriate permissions
</span></code></pre></div></p>
</li>
<li>
<p><strong>Enhanced Security Implementation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>Admin Console &gt; Security &gt; Authentication
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>- Enforce stronger authentication policies
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>- Consider Advanced Protection Program enrollment
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>- Implement login challenges
</span></code></pre></div></p>
</li>
<li>
<p><strong>Service Restoration Verification</strong></p>
</li>
<li>Confirm email flow is normal</li>
<li>Verify access to necessary applications</li>
<li>Validate file access and sharing capabilities</li>
<li>
<p>Ensure calendar and meeting functionality</p>
</li>
<li>
<p><strong>User Communication and Education</strong></p>
</li>
<li>Provide security awareness refresher</li>
<li>Explain incident and response actions</li>
<li>Advise on security best practices</li>
<li>Schedule follow-up security training</li>
</ol>
<h3 id="post-incident-analysis">Post-Incident Analysis<a class="headerlink" href="#post-incident-analysis" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Root Cause Identification</strong></li>
<li>Determine initial access vector</li>
<li>Identify security control failures</li>
<li>Document complete attack timeline</li>
<li>
<p>Assess effectiveness of security controls</p>
</li>
<li>
<p><strong>Security Enhancement Planning</strong></p>
</li>
<li>Identify specific control improvements</li>
<li>Develop enhancement implementation plan</li>
<li>Create timeline for security upgrades</li>
<li>
<p>Allocate resources for improvements</p>
</li>
<li>
<p><strong>Documentation and Reporting</strong></p>
</li>
<li>Complete incident documentation</li>
<li>Prepare executive summary</li>
<li>Document lessons learned</li>
<li>
<p>Create remediation tracking document</p>
</li>
<li>
<p><strong>Process Improvement</strong></p>
</li>
<li>Update detection capabilities</li>
<li>Enhance response procedures</li>
<li>Improve containment strategies</li>
<li>Strengthen recovery processes</li>
</ol>
<h2 id="data-exfiltration-incident-response">Data Exfiltration Incident Response<a class="headerlink" href="#data-exfiltration-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="incident-overview_1">Incident Overview<a class="headerlink" href="#incident-overview_1" title="Permanent link">&para;</a></h3>
<p><strong>Description:</strong><br />
Unauthorized extraction of sensitive data from Google Workspace services, including Drive, Gmail, Calendar, or other collaboration tools.</p>
<p><strong>Common Attack Vectors:</strong>
- Google Takeout exports
- Mass document downloads
- Email forwarding rules
- OAuth applications with extensive access
- Unauthorized API access to data
- Third-party integrations with excessive permissions</p>
<p><strong>Severity Classifications:</strong>
- <strong>Critical</strong>: Mass exfiltration of regulated or sensitive data
- <strong>High</strong>: Targeted exfiltration of sensitive information
- <strong>Medium</strong>: Limited exposure of internal information
- <strong>Low</strong>: Export of non-sensitive, non-proprietary data</p>
<h3 id="detection-and-analysis_1">Detection and Analysis<a class="headerlink" href="#detection-and-analysis_1" title="Permanent link">&para;</a></h3>
<p><strong>Initial Indicators:</strong>
- Unusual volume of file downloads
- Suspicious Google Takeout exports
- Unexpected external sharing of documents
- Unusual API request patterns
- Data access from atypical locations or times</p>
<p><strong>Investigation Procedures:</strong></p>
<ol>
<li>
<p><strong>Drive Activity Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Drive
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>- Filter for download, export activities
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>- Identify mass document access patterns
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>- Check for unusual sharing changes
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>- Look for unusual access times or locations
</span></code></pre></div></p>
</li>
<li>
<p><strong>Data Access Volume Assessment</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Python script to detect unusual data access volumes</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_unusual_data_access</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">timeframe_days</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Identify users with unusually high data access volumes&quot;&quot;&quot;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="c1"># Calculate start time</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">timeframe_days</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="c1"># Get Drive activities</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="n">drive_activities</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>        <span class="n">userKey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>        <span class="n">applicationName</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="n">eventName</span><span class="o">=</span><span class="s1">&#39;download,view,export&#39;</span><span class="p">,</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>        <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>        <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>    
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>    <span class="c1"># Aggregate by user</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    <span class="n">user_activity</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">drive_activities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        <span class="n">user</span> <span class="o">=</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;actor&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>        <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="p">:</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>                <span class="s1">&#39;download_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>                <span class="s1">&#39;view_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>                <span class="s1">&#39;export_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>                <span class="s1">&#39;files_accessed&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>                <span class="s1">&#39;access_ips&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>            <span class="p">}</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>            
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>        <span class="c1"># Extract event details</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>        <span class="n">event</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>        <span class="n">event_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>        
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>        <span class="c1"># Update counts</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>        <span class="k">if</span> <span class="s1">&#39;download&#39;</span> <span class="ow">in</span> <span class="n">event_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;download_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>        <span class="k">elif</span> <span class="s1">&#39;view&#39;</span> <span class="ow">in</span> <span class="n">event_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;view_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>        <span class="k">elif</span> <span class="s1">&#39;export&#39;</span> <span class="ow">in</span> <span class="n">event_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;export_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>            
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>        <span class="c1"># Add file ID</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>        <span class="n">doc_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>                       <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;doc_id&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>        <span class="k">if</span> <span class="n">doc_id</span><span class="p">:</span>
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;files_accessed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>            
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>        <span class="c1"># Add IP address</span>
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>        <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">):</span>
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>            <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_ips&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">))</span>
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>    
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a>    <span class="c1"># Convert sets to counts for easier analysis</span>
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="p">:</span>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>        <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;unique_files_accessed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;files_accessed&#39;</span><span class="p">])</span>
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a>        <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;unique_ips&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_ips&#39;</span><span class="p">])</span>
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>        <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;ip_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_ips&#39;</span><span class="p">])</span>
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>        <span class="k">del</span> <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;files_accessed&#39;</span><span class="p">]</span>
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>        <span class="k">del</span> <span class="n">user_activity</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_ips&#39;</span><span class="p">]</span>
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>    
</span><span id="__span-22-59"><a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a>    <span class="c1"># Calculate organizational averages</span>
</span><span id="__span-22-60"><a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a>    <span class="n">org_avg</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-22-61"><a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a>        <span class="s1">&#39;download_avg&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-62"><a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a>        <span class="s1">&#39;view_avg&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-63"><a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a>        <span class="s1">&#39;export_avg&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-22-64"><a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a>        <span class="s1">&#39;files_avg&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-22-65"><a id="__codelineno-22-65" name="__codelineno-22-65" href="#__codelineno-22-65"></a>    <span class="p">}</span>
</span><span id="__span-22-66"><a id="__codelineno-22-66" name="__codelineno-22-66" href="#__codelineno-22-66"></a>    
</span><span id="__span-22-67"><a id="__codelineno-22-67" name="__codelineno-22-67" href="#__codelineno-22-67"></a>    <span class="k">if</span> <span class="n">user_activity</span><span class="p">:</span>
</span><span id="__span-22-68"><a id="__codelineno-22-68" name="__codelineno-22-68" href="#__codelineno-22-68"></a>        <span class="n">user_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_activity</span><span class="p">)</span>
</span><span id="__span-22-69"><a id="__codelineno-22-69" name="__codelineno-22-69" href="#__codelineno-22-69"></a>        <span class="n">download_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s1">&#39;download_count&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-22-70"><a id="__codelineno-22-70" name="__codelineno-22-70" href="#__codelineno-22-70"></a>        <span class="n">view_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s1">&#39;view_count&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-22-71"><a id="__codelineno-22-71" name="__codelineno-22-71" href="#__codelineno-22-71"></a>        <span class="n">export_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s1">&#39;export_count&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-22-72"><a id="__codelineno-22-72" name="__codelineno-22-72" href="#__codelineno-22-72"></a>        <span class="n">files_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s1">&#39;unique_files_accessed&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-22-73"><a id="__codelineno-22-73" name="__codelineno-22-73" href="#__codelineno-22-73"></a>        
</span><span id="__span-22-74"><a id="__codelineno-22-74" name="__codelineno-22-74" href="#__codelineno-22-74"></a>        <span class="n">org_avg</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-22-75"><a id="__codelineno-22-75" name="__codelineno-22-75" href="#__codelineno-22-75"></a>            <span class="s1">&#39;download_avg&#39;</span><span class="p">:</span> <span class="n">download_total</span> <span class="o">/</span> <span class="n">user_count</span><span class="p">,</span>
</span><span id="__span-22-76"><a id="__codelineno-22-76" name="__codelineno-22-76" href="#__codelineno-22-76"></a>            <span class="s1">&#39;view_avg&#39;</span><span class="p">:</span> <span class="n">view_total</span> <span class="o">/</span> <span class="n">user_count</span><span class="p">,</span>
</span><span id="__span-22-77"><a id="__codelineno-22-77" name="__codelineno-22-77" href="#__codelineno-22-77"></a>            <span class="s1">&#39;export_avg&#39;</span><span class="p">:</span> <span class="n">export_total</span> <span class="o">/</span> <span class="n">user_count</span><span class="p">,</span>
</span><span id="__span-22-78"><a id="__codelineno-22-78" name="__codelineno-22-78" href="#__codelineno-22-78"></a>            <span class="s1">&#39;files_avg&#39;</span><span class="p">:</span> <span class="n">files_total</span> <span class="o">/</span> <span class="n">user_count</span>
</span><span id="__span-22-79"><a id="__codelineno-22-79" name="__codelineno-22-79" href="#__codelineno-22-79"></a>        <span class="p">}</span>
</span><span id="__span-22-80"><a id="__codelineno-22-80" name="__codelineno-22-80" href="#__codelineno-22-80"></a>    
</span><span id="__span-22-81"><a id="__codelineno-22-81" name="__codelineno-22-81" href="#__codelineno-22-81"></a>    <span class="c1"># Identify outliers (2x average as simple threshold)</span>
</span><span id="__span-22-82"><a id="__codelineno-22-82" name="__codelineno-22-82" href="#__codelineno-22-82"></a>    <span class="n">outliers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-22-83"><a id="__codelineno-22-83" name="__codelineno-22-83" href="#__codelineno-22-83"></a>    <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">user_activity</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-22-84"><a id="__codelineno-22-84" name="__codelineno-22-84" href="#__codelineno-22-84"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;download_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">org_avg</span><span class="p">[</span><span class="s1">&#39;download_avg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="ow">or</span>
</span><span id="__span-22-85"><a id="__codelineno-22-85" name="__codelineno-22-85" href="#__codelineno-22-85"></a>            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;export_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">org_avg</span><span class="p">[</span><span class="s1">&#39;export_avg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="__span-22-86"><a id="__codelineno-22-86" name="__codelineno-22-86" href="#__codelineno-22-86"></a>            <span class="n">outliers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-22-87"><a id="__codelineno-22-87" name="__codelineno-22-87" href="#__codelineno-22-87"></a>                <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
</span><span id="__span-22-88"><a id="__codelineno-22-88" name="__codelineno-22-88" href="#__codelineno-22-88"></a>                <span class="s1">&#39;stats&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">,</span>
</span><span id="__span-22-89"><a id="__codelineno-22-89" name="__codelineno-22-89" href="#__codelineno-22-89"></a>                <span class="s1">&#39;org_comparison&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-22-90"><a id="__codelineno-22-90" name="__codelineno-22-90" href="#__codelineno-22-90"></a>                    <span class="s1">&#39;download_ratio&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;download_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">org_avg</span><span class="p">[</span><span class="s1">&#39;download_avg&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-22-91"><a id="__codelineno-22-91" name="__codelineno-22-91" href="#__codelineno-22-91"></a>                    <span class="s1">&#39;export_ratio&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;export_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">org_avg</span><span class="p">[</span><span class="s1">&#39;export_avg&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-22-92"><a id="__codelineno-22-92" name="__codelineno-22-92" href="#__codelineno-22-92"></a>                <span class="p">}</span>
</span><span id="__span-22-93"><a id="__codelineno-22-93" name="__codelineno-22-93" href="#__codelineno-22-93"></a>            <span class="p">})</span>
</span><span id="__span-22-94"><a id="__codelineno-22-94" name="__codelineno-22-94" href="#__codelineno-22-94"></a>    
</span><span id="__span-22-95"><a id="__codelineno-22-95" name="__codelineno-22-95" href="#__codelineno-22-95"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-22-96"><a id="__codelineno-22-96" name="__codelineno-22-96" href="#__codelineno-22-96"></a>        <span class="s1">&#39;org_averages&#39;</span><span class="p">:</span> <span class="n">org_avg</span><span class="p">,</span>
</span><span id="__span-22-97"><a id="__codelineno-22-97" name="__codelineno-22-97" href="#__codelineno-22-97"></a>        <span class="s1">&#39;outliers&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="__span-22-98"><a id="__codelineno-22-98" name="__codelineno-22-98" href="#__codelineno-22-98"></a>            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;org_comparison&#39;</span><span class="p">][</span><span class="s1">&#39;download_ratio&#39;</span><span class="p">],</span>
</span><span id="__span-22-99"><a id="__codelineno-22-99" name="__codelineno-22-99" href="#__codelineno-22-99"></a>            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;org_comparison&#39;</span><span class="p">][</span><span class="s1">&#39;export_ratio&#39;</span><span class="p">]</span>
</span><span id="__span-22-100"><a id="__codelineno-22-100" name="__codelineno-22-100" href="#__codelineno-22-100"></a>        <span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-22-101"><a id="__codelineno-22-101" name="__codelineno-22-101" href="#__codelineno-22-101"></a>    <span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Google Takeout Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>Admin Console &gt; Reports &gt; Audit &gt; User accounts
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>- Filter for &quot;download_data&quot; events
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>- Identify unusual Takeout exports
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>- Check timing and frequency of exports
</span></code></pre></div></p>
</li>
<li>
<p><strong>External Sharing Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Drive
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>- Filter for &quot;change_user_access&quot; events
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>- Focus on events with external users
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>- Identify documents shared publicly
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Application Assessment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>- Identify newly authorized applications
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>- Review permissions and scopes
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>- Check for data access capabilities
</span></code></pre></div></p>
</li>
<li>
<p><strong>Evidence Collection</strong></p>
</li>
<li>Document data access patterns</li>
<li>Capture screenshots of relevant logs</li>
<li>Create timeline of data access events</li>
<li>List potentially exposed documents</li>
<li>Preserve original logs for investigation</li>
</ol>
<h3 id="containment-procedures_1">Containment Procedures<a class="headerlink" href="#containment-procedures_1" title="Permanent link">&para;</a></h3>
<p><strong>Immediate Actions:</strong></p>
<ol>
<li>
<p><strong>Account Access Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>Admin Console &gt; Directory &gt; Users
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>- Suspend suspected user accounts
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>- Reset passwords for affected accounts
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>- Terminate all active sessions
</span></code></pre></div></p>
</li>
<li>
<p><strong>External Sharing Limitation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Admin Console &gt; Apps &gt; Google Workspace &gt; Drive
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>- Restrict external sharing temporarily
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>- Block public link creation
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>- Disable file download for shared items
</span></code></pre></div></p>
</li>
<li>
<p><strong>Data Export Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>Admin Console &gt; Apps &gt; Google Workspace &gt; Settings for data access
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>- Disable Google Takeout for affected users
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>- Restrict data download capabilities
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>- Block API-based exports
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Application Blocking</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>- Block suspicious applications
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>- Revoke tokens for unauthorized apps
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>- Restrict new OAuth authorizations
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Secondary Containment:</strong></p>
<ol>
<li>
<p><strong>Drive Access Control Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a># For each affected user
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>- Identify sensitive shared documents
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>- Revoke inappropriate sharing permissions
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>- Set more restrictive access controls
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Access Limitation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>Admin Console &gt; Security &gt; API Controls &gt; Domain-wide delegation
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>- Review and adjust API access scopes
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>- Implement stricter API limitations
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>- Monitor API usage for anomalies
</span></code></pre></div></p>
</li>
<li>
<p><strong>Data Loss Prevention Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Admin Console &gt; Security &gt; Data protection
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>- Deploy additional DLP rules
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>- Implement content-aware access restrictions
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>- Configure sensitive content controls
</span></code></pre></div></p>
</li>
</ol>
<h3 id="eradication-steps_1">Eradication Steps<a class="headerlink" href="#eradication-steps_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Remove Unauthorized Access</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a># For each affected document/data source
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>- Remove external collaborators
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>- Revoke public sharing links
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>- Reset access controls to baseline
</span></code></pre></div></li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Python script to revert unauthorized sharing</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">revert_unauthorized_sharing</span><span class="p">(</span><span class="n">drive_service</span><span class="p">,</span> <span class="n">start_date</span><span class="p">):</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Revert unauthorized document sharing since given date&quot;&quot;&quot;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="c1"># Convert date to RFC 3339 timestamp</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="n">time_filter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;modifiedTime &gt; &#39;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="c1"># Get files with sharing changes</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    <span class="n">shared_files</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>        <span class="n">q</span><span class="o">=</span><span class="n">time_filter</span><span class="p">,</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>        <span class="n">spaces</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>        <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;files(id,name,permissions)&#39;</span><span class="p">,</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>        <span class="n">pageSize</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>    
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>    <span class="n">revocation_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>    
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">shared_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>        <span class="n">file_id</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>        
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>        <span class="c1"># Check each permission</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;permissions&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>            <span class="c1"># Identify suspicious permissions (external or anyone)</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>            <span class="k">if</span> <span class="n">is_suspicious_permission</span><span class="p">(</span><span class="n">permission</span><span class="p">):</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>                    <span class="c1"># Delete suspicious permission</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>                    <span class="n">drive_service</span><span class="o">.</span><span class="n">permissions</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>                        <span class="n">fileId</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>                        <span class="n">permissionId</span><span class="o">=</span><span class="n">permission</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>                    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>                    
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>                    <span class="n">revocation_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>                        <span class="s1">&#39;file_id&#39;</span><span class="p">:</span> <span class="n">file_id</span><span class="p">,</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>                        <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>                        <span class="s1">&#39;permission&#39;</span><span class="p">:</span> <span class="n">permission</span><span class="p">,</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;revoked&#39;</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a>                    <span class="p">})</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a>                    <span class="n">revocation_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a>                        <span class="s1">&#39;file_id&#39;</span><span class="p">:</span> <span class="n">file_id</span><span class="p">,</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>                        <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a>                        <span class="s1">&#39;permission&#39;</span><span class="p">:</span> <span class="n">permission</span><span class="p">,</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a>                    <span class="p">})</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a>    
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a>    <span class="k">return</span> <span class="n">revocation_results</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a>    
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_suspicious_permission</span><span class="p">(</span><span class="n">permission</span><span class="p">):</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a permission is suspicious based on criteria&quot;&quot;&quot;</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a>    <span class="c1"># Check for &#39;anyone&#39; access</span>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a>    <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;anyone&#39;</span><span class="p">:</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a>        
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a>    <span class="c1"># Check for external email domains</span>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a>    <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span> <span class="ow">and</span> <span class="n">permission</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emailAddress&#39;</span><span class="p">):</span>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">permission</span><span class="p">[</span><span class="s1">&#39;emailAddress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@company.com&#39;</span><span class="p">):</span>  <span class="c1"># Replace with your domain</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a>            
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a>    <span class="c1"># Add additional logic as needed</span>
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a>    <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div>
<ol>
<li>
<p><strong>Clean Up Automated Access</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a># Via API or Admin Console
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>- Remove unauthorized email forwarding
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>- Delete suspicious email filters
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>- Remove malicious Apps Script deployments
</span></code></pre></div></p>
</li>
<li>
<p><strong>Revoke OAuth Authorizations</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>Admin Console &gt; Security &gt; API Controls &gt; Domain-wide delegation
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>- Revoke delegated access for suspicious services
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>- Remove unnecessary API access
</span></code></pre></div></p>
</li>
<li>
<p><strong>Remove Persistent Access Mechanisms</strong></p>
</li>
<li>Disable unauthorized service accounts</li>
<li>Remove compromised API keys</li>
<li>Delete unauthorized Apps Script projects</li>
<li>Uninstall malicious Workspace Add-ons</li>
</ol>
<h3 id="recovery-guidance_1">Recovery Guidance<a class="headerlink" href="#recovery-guidance_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Service Restoration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a># For each affected user/system
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>- Restore appropriate access rights
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>- Re-enable necessary sharing capabilities
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>- Reauthorize legitimate applications
</span></code></pre></div></p>
</li>
<li>
<p><strong>Data Access Control Implementation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>Admin Console &gt; Apps &gt; Google Workspace &gt; Drive
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>- Implement enhanced sharing controls
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>- Deploy file classification system
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>- Configure sharing restrictions by file type
</span></code></pre></div></p>
</li>
<li>
<p><strong>DLP Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>Admin Console &gt; Security &gt; Data protection
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>- Deploy additional content scanning rules
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>- Implement stricter export controls
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>- Configure enhanced alerting for sensitive content
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Security Hardening</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>- Implement more granular API access controls
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>- Deploy API monitoring and anomaly detection
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>- Establish API usage baselines
</span></code></pre></div></p>
</li>
</ol>
<h3 id="post-incident-analysis_1">Post-Incident Analysis<a class="headerlink" href="#post-incident-analysis_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Data Exposure Assessment</strong></li>
<li>Identify all exposed documents</li>
<li>Determine sensitivity of exposed data</li>
<li>Assess regulatory compliance impact</li>
<li>
<p>Calculate potential business impact</p>
</li>
<li>
<p><strong>Control Gap Identification</strong></p>
</li>
<li>Identify DLP control failures</li>
<li>Assess sharing restriction effectiveness</li>
<li>Evaluate export control limitations</li>
<li>
<p>Review API security measures</p>
</li>
<li>
<p><strong>Security Enhancement Implementation</strong></p>
</li>
<li>Develop enhanced data protection controls</li>
<li>Implement improved monitoring capabilities</li>
<li>Deploy additional access restrictions</li>
<li>
<p>Create data classification system</p>
</li>
<li>
<p><strong>Documentation and Reporting</strong></p>
</li>
<li>Prepare data exposure report</li>
<li>Document control recommendations</li>
<li>Create incident summary</li>
<li>Develop security enhancement roadmap</li>
</ol>
<h2 id="oauth-token-abuse-incident-response">OAuth Token Abuse Incident Response<a class="headerlink" href="#oauth-token-abuse-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="incident-overview_2">Incident Overview<a class="headerlink" href="#incident-overview_2" title="Permanent link">&para;</a></h3>
<p><strong>Description:</strong><br />
Unauthorized access or activities using compromised OAuth tokens, potentially resulting in persistent access despite password changes and authentication enhancements.</p>
<p><strong>Common Attack Vectors:</strong>
- Phishing campaigns for OAuth authorization
- Malicious third-party applications
- Token theft via client-side attacks
- Excessive permission requests from applications
- Stolen refresh tokens from compromised devices</p>
<p><strong>Severity Classifications:</strong>
- <strong>Critical</strong>: Administrative access token compromise
- <strong>High</strong>: User token with extensive data access
- <strong>Medium</strong>: Limited-scope token for specific services
- <strong>Low</strong>: Minimal permission token with no sensitive data access</p>
<h3 id="detection-and-analysis_2">Detection and Analysis<a class="headerlink" href="#detection-and-analysis_2" title="Permanent link">&para;</a></h3>
<p><strong>Initial Indicators:</strong>
- Unusual application authorization activity
- API usage from unexpected locations
- Application access despite password changes
- Abnormal API request patterns or volumes
- Unusual scopes requested by applications</p>
<p><strong>Investigation Procedures:</strong></p>
<ol>
<li>
<p><strong>Token Activity Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Token
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>- Filter for token creation and usage events
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>- Identify applications with unusual activity
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>- Check for suspicious permission scopes
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Authorization Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>- Review recently authorized applications
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>- Check for applications with excessive permissions
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>- Identify unauthorized or suspicious applications
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Usage Analysis</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># Python script to analyze API usage patterns</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_api_usage</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">days_back</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze API usage patterns for anomalies&quot;&quot;&quot;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="c1"># Calculate start time</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_back</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    <span class="c1"># Get API activity events</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="n">api_events</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>        <span class="n">userKey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>        <span class="n">applicationName</span><span class="o">=</span><span class="s1">&#39;token&#39;</span><span class="p">,</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>        <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>        <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>    
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>    <span class="c1"># Analyze application usage</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>    <span class="n">app_activity</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>    <span class="n">user_app_activity</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>    
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">api_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>        <span class="c1"># Extract basic information</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>        <span class="n">user</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;actor&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>        <span class="n">app_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;app_name&#39;</span><span class="p">),</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>        <span class="n">client_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;client_id&#39;</span><span class="p">),</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>        <span class="n">scopes</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;scope&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>        
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>        <span class="c1"># Track by application</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a>        <span class="n">app_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a>        <span class="k">if</span> <span class="n">app_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app_activity</span><span class="p">:</span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a>            <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a>                <span class="s1">&#39;app_name&#39;</span><span class="p">:</span> <span class="n">app_name</span><span class="p">,</span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a>                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a>                <span class="s1">&#39;user_count&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a>                <span class="s1">&#39;ip_addresses&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>                <span class="s1">&#39;scope_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">scopes</span><span class="p">),</span>
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a>                <span class="s1">&#39;scopes&#39;</span><span class="p">:</span> <span class="n">scopes</span><span class="p">,</span>
</span><span id="__span-43-37"><a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a>                <span class="s1">&#39;high_risk_scopes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scopes</span> <span class="k">if</span> <span class="n">is_high_risk_scope</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span>
</span><span id="__span-43-38"><a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a>                <span class="s1">&#39;event_count&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-43-39"><a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a>            <span class="p">}</span>
</span><span id="__span-43-40"><a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a>        
</span><span id="__span-43-41"><a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a>        <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-43-42"><a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">):</span>
</span><span id="__span-43-43"><a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a>            <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">))</span>
</span><span id="__span-43-44"><a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a>        <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;event_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-43-45"><a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a>        
</span><span id="__span-43-46"><a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a>        <span class="c1"># Track by user and application</span>
</span><span id="__span-43-47"><a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a>        <span class="n">user_app_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">app_key</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-43-48"><a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a>        <span class="k">if</span> <span class="n">user_app_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_app_activity</span><span class="p">:</span>
</span><span id="__span-43-49"><a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a>            <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-43-50"><a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a>                <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
</span><span id="__span-43-51"><a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a>                <span class="s1">&#39;app_name&#39;</span><span class="p">:</span> <span class="n">app_name</span><span class="p">,</span>
</span><span id="__span-43-52"><a id="__codelineno-43-52" name="__codelineno-43-52" href="#__codelineno-43-52"></a>                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
</span><span id="__span-43-53"><a id="__codelineno-43-53" name="__codelineno-43-53" href="#__codelineno-43-53"></a>                <span class="s1">&#39;ip_addresses&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-43-54"><a id="__codelineno-43-54" name="__codelineno-43-54" href="#__codelineno-43-54"></a>                <span class="s1">&#39;scopes&#39;</span><span class="p">:</span> <span class="n">scopes</span><span class="p">,</span>
</span><span id="__span-43-55"><a id="__codelineno-43-55" name="__codelineno-43-55" href="#__codelineno-43-55"></a>                <span class="s1">&#39;event_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-43-56"><a id="__codelineno-43-56" name="__codelineno-43-56" href="#__codelineno-43-56"></a>                <span class="s1">&#39;first_seen&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
</span><span id="__span-43-57"><a id="__codelineno-43-57" name="__codelineno-43-57" href="#__codelineno-43-57"></a>                <span class="s1">&#39;last_seen&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</span><span id="__span-43-58"><a id="__codelineno-43-58" name="__codelineno-43-58" href="#__codelineno-43-58"></a>            <span class="p">}</span>
</span><span id="__span-43-59"><a id="__codelineno-43-59" name="__codelineno-43-59" href="#__codelineno-43-59"></a>        
</span><span id="__span-43-60"><a id="__codelineno-43-60" name="__codelineno-43-60" href="#__codelineno-43-60"></a>        <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;event_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-43-61"><a id="__codelineno-43-61" name="__codelineno-43-61" href="#__codelineno-43-61"></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">):</span>
</span><span id="__span-43-62"><a id="__codelineno-43-62" name="__codelineno-43-62" href="#__codelineno-43-62"></a>            <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">))</span>
</span><span id="__span-43-63"><a id="__codelineno-43-63" name="__codelineno-43-63" href="#__codelineno-43-63"></a>        
</span><span id="__span-43-64"><a id="__codelineno-43-64" name="__codelineno-43-64" href="#__codelineno-43-64"></a>        <span class="c1"># Update last seen</span>
</span><span id="__span-43-65"><a id="__codelineno-43-65" name="__codelineno-43-65" href="#__codelineno-43-65"></a>        <span class="n">event_time</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</span><span id="__span-43-66"><a id="__codelineno-43-66" name="__codelineno-43-66" href="#__codelineno-43-66"></a>        <span class="k">if</span> <span class="n">event_time</span> <span class="ow">and</span> <span class="n">event_time</span> <span class="o">&gt;</span> <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]:</span>
</span><span id="__span-43-67"><a id="__codelineno-43-67" name="__codelineno-43-67" href="#__codelineno-43-67"></a>            <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_time</span>
</span><span id="__span-43-68"><a id="__codelineno-43-68" name="__codelineno-43-68" href="#__codelineno-43-68"></a>    
</span><span id="__span-43-69"><a id="__codelineno-43-69" name="__codelineno-43-69" href="#__codelineno-43-69"></a>    <span class="c1"># Convert sets to counts and lists</span>
</span><span id="__span-43-70"><a id="__codelineno-43-70" name="__codelineno-43-70" href="#__codelineno-43-70"></a>    <span class="k">for</span> <span class="n">app_key</span> <span class="ow">in</span> <span class="n">app_activity</span><span class="p">:</span>
</span><span id="__span-43-71"><a id="__codelineno-43-71" name="__codelineno-43-71" href="#__codelineno-43-71"></a>        <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;user_count&#39;</span><span class="p">])</span>
</span><span id="__span-43-72"><a id="__codelineno-43-72" name="__codelineno-43-72" href="#__codelineno-43-72"></a>        <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-43-73"><a id="__codelineno-43-73" name="__codelineno-43-73" href="#__codelineno-43-73"></a>        <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-43-74"><a id="__codelineno-43-74" name="__codelineno-43-74" href="#__codelineno-43-74"></a>        <span class="k">del</span> <span class="n">app_activity</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span>
</span><span id="__span-43-75"><a id="__codelineno-43-75" name="__codelineno-43-75" href="#__codelineno-43-75"></a>    
</span><span id="__span-43-76"><a id="__codelineno-43-76" name="__codelineno-43-76" href="#__codelineno-43-76"></a>    <span class="k">for</span> <span class="n">user_app_key</span> <span class="ow">in</span> <span class="n">user_app_activity</span><span class="p">:</span>
</span><span id="__span-43-77"><a id="__codelineno-43-77" name="__codelineno-43-77" href="#__codelineno-43-77"></a>        <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-43-78"><a id="__codelineno-43-78" name="__codelineno-43-78" href="#__codelineno-43-78"></a>        <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-43-79"><a id="__codelineno-43-79" name="__codelineno-43-79" href="#__codelineno-43-79"></a>        <span class="k">del</span> <span class="n">user_app_activity</span><span class="p">[</span><span class="n">user_app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span>
</span><span id="__span-43-80"><a id="__codelineno-43-80" name="__codelineno-43-80" href="#__codelineno-43-80"></a>    
</span><span id="__span-43-81"><a id="__codelineno-43-81" name="__codelineno-43-81" href="#__codelineno-43-81"></a>    <span class="c1"># Identify suspicious applications</span>
</span><span id="__span-43-82"><a id="__codelineno-43-82" name="__codelineno-43-82" href="#__codelineno-43-82"></a>    <span class="n">suspicious_apps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-43-83"><a id="__codelineno-43-83" name="__codelineno-43-83" href="#__codelineno-43-83"></a>    <span class="k">for</span> <span class="n">app_key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">app_activity</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-43-84"><a id="__codelineno-43-84" name="__codelineno-43-84" href="#__codelineno-43-84"></a>        <span class="n">risk_score</span> <span class="o">=</span> <span class="n">calculate_app_risk_score</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-43-85"><a id="__codelineno-43-85" name="__codelineno-43-85" href="#__codelineno-43-85"></a>        <span class="k">if</span> <span class="n">risk_score</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># Arbitrary threshold</span>
</span><span id="__span-43-86"><a id="__codelineno-43-86" name="__codelineno-43-86" href="#__codelineno-43-86"></a>            <span class="n">suspicious_apps</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-43-87"><a id="__codelineno-43-87" name="__codelineno-43-87" href="#__codelineno-43-87"></a>                <span class="s1">&#39;app_key&#39;</span><span class="p">:</span> <span class="n">app_key</span><span class="p">,</span>
</span><span id="__span-43-88"><a id="__codelineno-43-88" name="__codelineno-43-88" href="#__codelineno-43-88"></a>                <span class="s1">&#39;risk_score&#39;</span><span class="p">:</span> <span class="n">risk_score</span><span class="p">,</span>
</span><span id="__span-43-89"><a id="__codelineno-43-89" name="__codelineno-43-89" href="#__codelineno-43-89"></a>                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span>
</span><span id="__span-43-90"><a id="__codelineno-43-90" name="__codelineno-43-90" href="#__codelineno-43-90"></a>            <span class="p">})</span>
</span><span id="__span-43-91"><a id="__codelineno-43-91" name="__codelineno-43-91" href="#__codelineno-43-91"></a>    
</span><span id="__span-43-92"><a id="__codelineno-43-92" name="__codelineno-43-92" href="#__codelineno-43-92"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-43-93"><a id="__codelineno-43-93" name="__codelineno-43-93" href="#__codelineno-43-93"></a>        <span class="s1">&#39;app_activity&#39;</span><span class="p">:</span> <span class="n">app_activity</span><span class="p">,</span>
</span><span id="__span-43-94"><a id="__codelineno-43-94" name="__codelineno-43-94" href="#__codelineno-43-94"></a>        <span class="s1">&#39;user_app_activity&#39;</span><span class="p">:</span> <span class="n">user_app_activity</span><span class="p">,</span>
</span><span id="__span-43-95"><a id="__codelineno-43-95" name="__codelineno-43-95" href="#__codelineno-43-95"></a>        <span class="s1">&#39;suspicious_apps&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">suspicious_apps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;risk_score&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-43-96"><a id="__codelineno-43-96" name="__codelineno-43-96" href="#__codelineno-43-96"></a>    <span class="p">}</span>
</span><span id="__span-43-97"><a id="__codelineno-43-97" name="__codelineno-43-97" href="#__codelineno-43-97"></a>
</span><span id="__span-43-98"><a id="__codelineno-43-98" name="__codelineno-43-98" href="#__codelineno-43-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_high_risk_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span><span id="__span-43-99"><a id="__codelineno-43-99" name="__codelineno-43-99" href="#__codelineno-43-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a scope is high-risk&quot;&quot;&quot;</span>
</span><span id="__span-43-100"><a id="__codelineno-43-100" name="__codelineno-43-100" href="#__codelineno-43-100"></a>    <span class="n">high_risk_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-43-101"><a id="__codelineno-43-101" name="__codelineno-43-101" href="#__codelineno-43-101"></a>        <span class="s1">&#39;https://mail.google.com/&#39;</span><span class="p">,</span>
</span><span id="__span-43-102"><a id="__codelineno-43-102" name="__codelineno-43-102" href="#__codelineno-43-102"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">,</span>
</span><span id="__span-43-103"><a id="__codelineno-43-103" name="__codelineno-43-103" href="#__codelineno-43-103"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/admin&#39;</span><span class="p">,</span>
</span><span id="__span-43-104"><a id="__codelineno-43-104" name="__codelineno-43-104" href="#__codelineno-43-104"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/cloud-platform&#39;</span><span class="p">,</span>
</span><span id="__span-43-105"><a id="__codelineno-43-105" name="__codelineno-43-105" href="#__codelineno-43-105"></a>        <span class="s1">&#39;.readonly&#39;</span><span class="p">,</span>  <span class="c1"># Wildcard for read access to services</span>
</span><span id="__span-43-106"><a id="__codelineno-43-106" name="__codelineno-43-106" href="#__codelineno-43-106"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/contacts&#39;</span><span class="p">,</span>
</span><span id="__span-43-107"><a id="__codelineno-43-107" name="__codelineno-43-107" href="#__codelineno-43-107"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/calendar&#39;</span>
</span><span id="__span-43-108"><a id="__codelineno-43-108" name="__codelineno-43-108" href="#__codelineno-43-108"></a>    <span class="p">]</span>
</span><span id="__span-43-109"><a id="__codelineno-43-109" name="__codelineno-43-109" href="#__codelineno-43-109"></a>    
</span><span id="__span-43-110"><a id="__codelineno-43-110" name="__codelineno-43-110" href="#__codelineno-43-110"></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">scope</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">high_risk_indicators</span><span class="p">)</span>
</span><span id="__span-43-111"><a id="__codelineno-43-111" name="__codelineno-43-111" href="#__codelineno-43-111"></a>
</span><span id="__span-43-112"><a id="__codelineno-43-112" name="__codelineno-43-112" href="#__codelineno-43-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_app_risk_score</span><span class="p">(</span><span class="n">app_data</span><span class="p">):</span>
</span><span id="__span-43-113"><a id="__codelineno-43-113" name="__codelineno-43-113" href="#__codelineno-43-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate a risk score for an application based on various factors&quot;&quot;&quot;</span>
</span><span id="__span-43-114"><a id="__codelineno-43-114" name="__codelineno-43-114" href="#__codelineno-43-114"></a>    <span class="n">risk_score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-43-115"><a id="__codelineno-43-115" name="__codelineno-43-115" href="#__codelineno-43-115"></a>    
</span><span id="__span-43-116"><a id="__codelineno-43-116" name="__codelineno-43-116" href="#__codelineno-43-116"></a>    <span class="c1"># More users = higher potential impact</span>
</span><span id="__span-43-117"><a id="__codelineno-43-117" name="__codelineno-43-117" href="#__codelineno-43-117"></a>    <span class="k">if</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-43-118"><a id="__codelineno-43-118" name="__codelineno-43-118" href="#__codelineno-43-118"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-43-119"><a id="__codelineno-43-119" name="__codelineno-43-119" href="#__codelineno-43-119"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-43-120"><a id="__codelineno-43-120" name="__codelineno-43-120" href="#__codelineno-43-120"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-43-121"><a id="__codelineno-43-121" name="__codelineno-43-121" href="#__codelineno-43-121"></a>    
</span><span id="__span-43-122"><a id="__codelineno-43-122" name="__codelineno-43-122" href="#__codelineno-43-122"></a>    <span class="c1"># High number of scopes increases risk</span>
</span><span id="__span-43-123"><a id="__codelineno-43-123" name="__codelineno-43-123" href="#__codelineno-43-123"></a>    <span class="k">if</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-43-124"><a id="__codelineno-43-124" name="__codelineno-43-124" href="#__codelineno-43-124"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">3</span>
</span><span id="__span-43-125"><a id="__codelineno-43-125" name="__codelineno-43-125" href="#__codelineno-43-125"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-43-126"><a id="__codelineno-43-126" name="__codelineno-43-126" href="#__codelineno-43-126"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-43-127"><a id="__codelineno-43-127" name="__codelineno-43-127" href="#__codelineno-43-127"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-43-128"><a id="__codelineno-43-128" name="__codelineno-43-128" href="#__codelineno-43-128"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-43-129"><a id="__codelineno-43-129" name="__codelineno-43-129" href="#__codelineno-43-129"></a>    
</span><span id="__span-43-130"><a id="__codelineno-43-130" name="__codelineno-43-130" href="#__codelineno-43-130"></a>    <span class="c1"># High-risk scopes significantly increase risk</span>
</span><span id="__span-43-131"><a id="__codelineno-43-131" name="__codelineno-43-131" href="#__codelineno-43-131"></a>    <span class="n">risk_score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;high_risk_scopes&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="__span-43-132"><a id="__codelineno-43-132" name="__codelineno-43-132" href="#__codelineno-43-132"></a>    
</span><span id="__span-43-133"><a id="__codelineno-43-133" name="__codelineno-43-133" href="#__codelineno-43-133"></a>    <span class="c1"># Multiple IP addresses may indicate broader usage</span>
</span><span id="__span-43-134"><a id="__codelineno-43-134" name="__codelineno-43-134" href="#__codelineno-43-134"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;ip_list&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-43-135"><a id="__codelineno-43-135" name="__codelineno-43-135" href="#__codelineno-43-135"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-43-136"><a id="__codelineno-43-136" name="__codelineno-43-136" href="#__codelineno-43-136"></a>    
</span><span id="__span-43-137"><a id="__codelineno-43-137" name="__codelineno-43-137" href="#__codelineno-43-137"></a>    <span class="k">return</span> <span class="n">risk_score</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Token Revocation Testing</strong></p>
</li>
<li>Test revocation impact on applications</li>
<li>Identify applications unaffected by password changes</li>
<li>
<p>Verify token expiration enforcement</p>
</li>
<li>
<p><strong>Scope Analysis</strong></p>
</li>
<li>Identify token scopes and permissions</li>
<li>Evaluate potential access granted</li>
<li>
<p>Assess data exposure risk</p>
</li>
<li>
<p><strong>Evidence Collection</strong></p>
</li>
<li>Document affected applications and tokens</li>
<li>Capture relevant API access logs</li>
<li>Record suspicious token activity</li>
<li>Preserve authorization request evidence</li>
</ol>
<h3 id="containment-procedures_2">Containment Procedures<a class="headerlink" href="#containment-procedures_2" title="Permanent link">&para;</a></h3>
<p><strong>Immediate Actions:</strong></p>
<ol>
<li>
<p><strong>Token Revocation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Admin Console &gt; Security &gt; API Controls &gt; Domain-wide delegation
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>- Revoke tokens for suspected applications
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>- Remove domain-wide delegations for compromised services
</span></code></pre></div></p>
</li>
<li>
<p><strong>Account Security Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>Admin Console &gt; Directory &gt; Users &gt; [User] &gt; &quot;Security&quot;
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>- Reset passwords for affected accounts
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>- Force application logout
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>- Enable enhanced security verification
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Blocking</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>- Block suspicious applications
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>- Restrict future authorizations
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>- Implement app allowlisting for critical users
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Secondary Containment:</strong></p>
<ol>
<li>
<p><strong>Access Scope Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>- Restrict available API scopes
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>- Implement more granular permissions
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>- Configure access boundaries
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Access Monitoring</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a># Via custom monitoring or security tool
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>- Deploy enhanced API monitoring
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>- Create alerts for suspicious activity
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>- Implement token usage baselines
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Authorization Controls</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>- Configure application verification requirements
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>- Implement approval workflows for sensitive apps
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>- Deploy risky application alerting
</span></code></pre></div></p>
</li>
</ol>
<h3 id="eradication-steps_2">Eradication Steps<a class="headerlink" href="#eradication-steps_2" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Comprehensive Token Revocation</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Python script to revoke tokens for specific applications</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">revoke_application_tokens</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">admin_service</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Revoke tokens for a specific client ID across all users&quot;&quot;&quot;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    <span class="c1"># Get all users</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>    <span class="n">users_result</span> <span class="o">=</span> <span class="n">admin_service</span><span class="o">.</span><span class="n">users</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>        <span class="n">customer</span><span class="o">=</span><span class="s1">&#39;my_customer&#39;</span><span class="p">,</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>        <span class="n">maxResults</span><span class="o">=</span><span class="mi">500</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>    
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>    <span class="n">revocation_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>    
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>        <span class="n">user_email</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;primaryEmail&#39;</span><span class="p">]</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a>        
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>        <span class="c1"># Get token events to identify tokens for this client</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a>            <span class="n">token_events</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>                <span class="n">userKey</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a>                <span class="n">applicationName</span><span class="o">=</span><span class="s1">&#39;token&#39;</span><span class="p">,</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a>                <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>            <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a>            
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a>            <span class="c1"># Look for matching client ID</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a>            <span class="n">has_token</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">token_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a>                <span class="n">event_client_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> 
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a>                                       <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;client_id&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a>                
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a>                <span class="k">if</span> <span class="n">event_client_id</span> <span class="o">==</span> <span class="n">client_id</span><span class="p">:</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a>                    <span class="n">has_token</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a>                    <span class="k">break</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a>            
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a>            <span class="k">if</span> <span class="n">has_token</span><span class="p">:</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a>                <span class="c1"># Revoke access for this user</span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a>                    <span class="n">admin_service</span><span class="o">.</span><span class="n">tokens</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a>                        <span class="n">userKey</span><span class="o">=</span><span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a>                        <span class="n">clientId</span><span class="o">=</span><span class="n">client_id</span>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a>                    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a>                    
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a>                    <span class="n">revocation_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a>                        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;revoked&#39;</span>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a>                    <span class="p">})</span>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a>                    <span class="n">revocation_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a>                        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a>                    <span class="p">})</span>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a>            <span class="n">revocation_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a>                <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user_email</span><span class="p">,</span>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;lookup_error&#39;</span><span class="p">,</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a>            <span class="p">})</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a>    
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a>    <span class="k">return</span> <span class="n">revocation_results</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth App Removal</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>- Remove malicious applications from allowlist
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>- Block compromised app client IDs
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>- Implement stricter app verification requirements
</span></code></pre></div></p>
</li>
<li>
<p><strong>Service Account Cleanup</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>Admin Console &gt; Security &gt; API Controls &gt; Domain-wide delegation
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>- Review and clean up service accounts
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>- Verify legitimate delegations
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>- Reduce permissions to least privilege
</span></code></pre></div></p>
</li>
<li>
<p><strong>Extension and Add-on Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>Admin Console &gt; Apps &gt; Marketplace apps
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>- Remove unauthorized browser extensions
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>- Uninstall suspicious Workspace add-ons
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>- Validate legitimate integrations
</span></code></pre></div></p>
</li>
</ol>
<h3 id="recovery-guidance_2">Recovery Guidance<a class="headerlink" href="#recovery-guidance_2" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Application Access Restoration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a># For legitimate applications
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>- Reauthorize essential applications
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>- Guide users through proper authorization process
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>- Validate proper scope requests
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Control Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>- Implement enhanced API access controls
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>- Deploy API access monitoring
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>- Configure more granular permissions
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Governance Implementation</strong></p>
</li>
<li>Deploy OAuth application inventory process</li>
<li>Implement regular access reviews</li>
<li>Create application authorization framework</li>
<li>
<p>Establish scope restriction policies</p>
</li>
<li>
<p><strong>User Communication and Training</strong></p>
</li>
<li>Provide guidance on safe application authorization</li>
<li>Educate on permission evaluation</li>
<li>Deploy phishing awareness for OAuth-based attacks</li>
<li>Create clear escalation procedures</li>
</ol>
<h3 id="post-incident-analysis_2">Post-Incident Analysis<a class="headerlink" href="#post-incident-analysis_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Token Abuse Impact Assessment</strong></li>
<li>Identify accessed data and services</li>
<li>Determine duration of unauthorized access</li>
<li>Assess regulatory compliance impact</li>
<li>
<p>Document business impact</p>
</li>
<li>
<p><strong>OAuth Security Evaluation</strong></p>
</li>
<li>Review OAuth authorization controls</li>
<li>Assess token management practices</li>
<li>Evaluate monitoring effectiveness</li>
<li>
<p>Identify security control gaps</p>
</li>
<li>
<p><strong>Documentation and Reporting</strong></p>
</li>
<li>Document affected applications and users</li>
<li>Create comprehensive timeline</li>
<li>Prepare executive summary</li>
<li>
<p>Develop token security roadmap</p>
</li>
<li>
<p><strong>Security Enhancement Implementation</strong></p>
</li>
<li>Deploy OAuth governance framework</li>
<li>Implement enhanced monitoring</li>
<li>Establish token usage baselines</li>
<li>Create application vetting process</li>
</ol>
<h2 id="admin-privilege-escalation-incident-response">Admin Privilege Escalation Incident Response<a class="headerlink" href="#admin-privilege-escalation-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="incident-overview_3">Incident Overview<a class="headerlink" href="#incident-overview_3" title="Permanent link">&para;</a></h3>
<p><strong>Description:</strong><br />
Unauthorized acquisition or use of administrative privileges within Google Workspace, potentially resulting in organization-wide security compromises, configuration changes, or data access.</p>
<p><strong>Common Attack Vectors:</strong>
- Phishing attacks targeting admins
- Role privilege elevation through compromised accounts
- Creation of unauthorized admin accounts
- Exploitation of delegated admin rights
- OAuth application with admin capabilities
- Recovery email/phone compromise for admins</p>
<p><strong>Severity Classifications:</strong>
- <strong>Critical</strong>: Super admin compromise
- <strong>High</strong>: Privilege escalation to admin with significant rights
- <strong>Medium</strong>: Limited admin role compromise
- <strong>Low</strong>: Attempted but unsuccessful admin privilege acquisition</p>
<h3 id="detection-and-analysis_3">Detection and Analysis<a class="headerlink" href="#detection-and-analysis_3" title="Permanent link">&para;</a></h3>
<p><strong>Initial Indicators:</strong>
- Unexpected admin role assignments
- Unusual administrative console access
- Configuration changes without approval
- Suspicious admin activities from unusual locations
- Creation of new admin accounts
- Modification of admin recovery settings</p>
<p><strong>Investigation Procedures:</strong></p>
<ol>
<li>
<p><strong>Admin Activity Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Admin
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>- Filter for role assignment changes
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>- Identify unusual admin console access
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>- Look for critical setting modifications
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>- Check for new admin user creation
</span></code></pre></div></p>
</li>
<li>
<p><strong>Admin Role Assessment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>- Review all admin role assignments
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>- Identify unauthorized or excessive permissions
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>- Check for recently modified roles
</span></code></pre></div></p>
</li>
<li>
<p><strong>Admin Access Pattern Analysis</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># Python script to analyze admin access patterns</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_admin_access_patterns</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">days_back</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze admin console access patterns for anomalies&quot;&quot;&quot;</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>    <span class="c1"># Calculate start time</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_back</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>    
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>    <span class="c1"># Get admin console activities</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>    <span class="n">admin_events</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>        <span class="n">userKey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>        <span class="n">applicationName</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>        <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>        <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>    
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>    <span class="c1"># Organize by user</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>    <span class="n">admin_access</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>    
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">admin_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a>        <span class="n">user</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;actor&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>        <span class="n">event_time</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a>        <span class="n">event_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a>        <span class="n">ip_address</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">)</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a>        
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24" href="#__codelineno-58-24"></a>        <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">admin_access</span><span class="p">:</span>
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25" href="#__codelineno-58-25"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-58-26"><a id="__codelineno-58-26" name="__codelineno-58-26" href="#__codelineno-58-26"></a>                <span class="s1">&#39;access_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-58-27"><a id="__codelineno-58-27" name="__codelineno-58-27" href="#__codelineno-58-27"></a>                <span class="s1">&#39;ip_addresses&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-58-28"><a id="__codelineno-58-28" name="__codelineno-58-28" href="#__codelineno-58-28"></a>                <span class="s1">&#39;common_events&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-58-29"><a id="__codelineno-58-29" name="__codelineno-58-29" href="#__codelineno-58-29"></a>                <span class="s1">&#39;access_times&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-58-30"><a id="__codelineno-58-30" name="__codelineno-58-30" href="#__codelineno-58-30"></a>                <span class="s1">&#39;first_seen&#39;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="__span-58-31"><a id="__codelineno-58-31" name="__codelineno-58-31" href="#__codelineno-58-31"></a>                <span class="s1">&#39;last_seen&#39;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="__span-58-32"><a id="__codelineno-58-32" name="__codelineno-58-32" href="#__codelineno-58-32"></a>                <span class="s1">&#39;critical_events&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="__span-58-33"><a id="__codelineno-58-33" name="__codelineno-58-33" href="#__codelineno-58-33"></a>            <span class="p">}</span>
</span><span id="__span-58-34"><a id="__codelineno-58-34" name="__codelineno-58-34" href="#__codelineno-58-34"></a>        
</span><span id="__span-58-35"><a id="__codelineno-58-35" name="__codelineno-58-35" href="#__codelineno-58-35"></a>        <span class="c1"># Update user data</span>
</span><span id="__span-58-36"><a id="__codelineno-58-36" name="__codelineno-58-36" href="#__codelineno-58-36"></a>        <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-58-37"><a id="__codelineno-58-37" name="__codelineno-58-37" href="#__codelineno-58-37"></a>        <span class="k">if</span> <span class="n">ip_address</span><span class="p">:</span>
</span><span id="__span-58-38"><a id="__codelineno-58-38" name="__codelineno-58-38" href="#__codelineno-58-38"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
</span><span id="__span-58-39"><a id="__codelineno-58-39" name="__codelineno-58-39" href="#__codelineno-58-39"></a>        
</span><span id="__span-58-40"><a id="__codelineno-58-40" name="__codelineno-58-40" href="#__codelineno-58-40"></a>        <span class="c1"># Track event frequency</span>
</span><span id="__span-58-41"><a id="__codelineno-58-41" name="__codelineno-58-41" href="#__codelineno-58-41"></a>        <span class="k">if</span> <span class="n">event_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;common_events&#39;</span><span class="p">]:</span>
</span><span id="__span-58-42"><a id="__codelineno-58-42" name="__codelineno-58-42" href="#__codelineno-58-42"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;common_events&#39;</span><span class="p">][</span><span class="n">event_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-58-43"><a id="__codelineno-58-43" name="__codelineno-58-43" href="#__codelineno-58-43"></a>        <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;common_events&#39;</span><span class="p">][</span><span class="n">event_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-58-44"><a id="__codelineno-58-44" name="__codelineno-58-44" href="#__codelineno-58-44"></a>        
</span><span id="__span-58-45"><a id="__codelineno-58-45" name="__codelineno-58-45" href="#__codelineno-58-45"></a>        <span class="c1"># Update access times</span>
</span><span id="__span-58-46"><a id="__codelineno-58-46" name="__codelineno-58-46" href="#__codelineno-58-46"></a>        <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;access_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_time</span><span class="p">)</span>
</span><span id="__span-58-47"><a id="__codelineno-58-47" name="__codelineno-58-47" href="#__codelineno-58-47"></a>        
</span><span id="__span-58-48"><a id="__codelineno-58-48" name="__codelineno-58-48" href="#__codelineno-58-48"></a>        <span class="c1"># Update first/last seen</span>
</span><span id="__span-58-49"><a id="__codelineno-58-49" name="__codelineno-58-49" href="#__codelineno-58-49"></a>        <span class="k">if</span> <span class="n">event_time</span> <span class="o">&lt;</span> <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;first_seen&#39;</span><span class="p">]:</span>
</span><span id="__span-58-50"><a id="__codelineno-58-50" name="__codelineno-58-50" href="#__codelineno-58-50"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;first_seen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_time</span>
</span><span id="__span-58-51"><a id="__codelineno-58-51" name="__codelineno-58-51" href="#__codelineno-58-51"></a>        <span class="k">if</span> <span class="n">event_time</span> <span class="o">&gt;</span> <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]:</span>
</span><span id="__span-58-52"><a id="__codelineno-58-52" name="__codelineno-58-52" href="#__codelineno-58-52"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_time</span>
</span><span id="__span-58-53"><a id="__codelineno-58-53" name="__codelineno-58-53" href="#__codelineno-58-53"></a>        
</span><span id="__span-58-54"><a id="__codelineno-58-54" name="__codelineno-58-54" href="#__codelineno-58-54"></a>        <span class="c1"># Check for critical events</span>
</span><span id="__span-58-55"><a id="__codelineno-58-55" name="__codelineno-58-55" href="#__codelineno-58-55"></a>        <span class="k">if</span> <span class="n">is_critical_admin_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
</span><span id="__span-58-56"><a id="__codelineno-58-56" name="__codelineno-58-56" href="#__codelineno-58-56"></a>            <span class="n">admin_access</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="s1">&#39;critical_events&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-58-57"><a id="__codelineno-58-57" name="__codelineno-58-57" href="#__codelineno-58-57"></a>                <span class="s1">&#39;event_name&#39;</span><span class="p">:</span> <span class="n">event_name</span><span class="p">,</span>
</span><span id="__span-58-58"><a id="__codelineno-58-58" name="__codelineno-58-58" href="#__codelineno-58-58"></a>                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="__span-58-59"><a id="__codelineno-58-59" name="__codelineno-58-59" href="#__codelineno-58-59"></a>                <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="n">ip_address</span><span class="p">,</span>
</span><span id="__span-58-60"><a id="__codelineno-58-60" name="__codelineno-58-60" href="#__codelineno-58-60"></a>                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">extract_event_details</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="__span-58-61"><a id="__codelineno-58-61" name="__codelineno-58-61" href="#__codelineno-58-61"></a>            <span class="p">})</span>
</span><span id="__span-58-62"><a id="__codelineno-58-62" name="__codelineno-58-62" href="#__codelineno-58-62"></a>    
</span><span id="__span-58-63"><a id="__codelineno-58-63" name="__codelineno-58-63" href="#__codelineno-58-63"></a>    <span class="c1"># Process data for analysis</span>
</span><span id="__span-58-64"><a id="__codelineno-58-64" name="__codelineno-58-64" href="#__codelineno-58-64"></a>    <span class="n">admin_insights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-58-65"><a id="__codelineno-58-65" name="__codelineno-58-65" href="#__codelineno-58-65"></a>    <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">admin_access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-58-66"><a id="__codelineno-58-66" name="__codelineno-58-66" href="#__codelineno-58-66"></a>        <span class="c1"># Convert sets to lists/counts</span>
</span><span id="__span-58-67"><a id="__codelineno-58-67" name="__codelineno-58-67" href="#__codelineno-58-67"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-58-68"><a id="__codelineno-58-68" name="__codelineno-58-68" href="#__codelineno-58-68"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-58-69"><a id="__codelineno-58-69" name="__codelineno-58-69" href="#__codelineno-58-69"></a>        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span>
</span><span id="__span-58-70"><a id="__codelineno-58-70" name="__codelineno-58-70" href="#__codelineno-58-70"></a>        
</span><span id="__span-58-71"><a id="__codelineno-58-71" name="__codelineno-58-71" href="#__codelineno-58-71"></a>        <span class="c1"># Sort critical events by time</span>
</span><span id="__span-58-72"><a id="__codelineno-58-72" name="__codelineno-58-72" href="#__codelineno-58-72"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;critical_events&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
</span><span id="__span-58-73"><a id="__codelineno-58-73" name="__codelineno-58-73" href="#__codelineno-58-73"></a>        
</span><span id="__span-58-74"><a id="__codelineno-58-74" name="__codelineno-58-74" href="#__codelineno-58-74"></a>        <span class="c1"># Calculate working hours access percentage</span>
</span><span id="__span-58-75"><a id="__codelineno-58-75" name="__codelineno-58-75" href="#__codelineno-58-75"></a>        <span class="n">work_hours_access</span> <span class="o">=</span> <span class="n">calculate_work_hours_percentage</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;access_times&#39;</span><span class="p">])</span>
</span><span id="__span-58-76"><a id="__codelineno-58-76" name="__codelineno-58-76" href="#__codelineno-58-76"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;work_hours_percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">work_hours_access</span>
</span><span id="__span-58-77"><a id="__codelineno-58-77" name="__codelineno-58-77" href="#__codelineno-58-77"></a>        
</span><span id="__span-58-78"><a id="__codelineno-58-78" name="__codelineno-58-78" href="#__codelineno-58-78"></a>        <span class="c1"># Calculate common events</span>
</span><span id="__span-58-79"><a id="__codelineno-58-79" name="__codelineno-58-79" href="#__codelineno-58-79"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;common_events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-58-80"><a id="__codelineno-58-80" name="__codelineno-58-80" href="#__codelineno-58-80"></a>            <span class="p">[{</span><span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;common_events&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
</span><span id="__span-58-81"><a id="__codelineno-58-81" name="__codelineno-58-81" href="#__codelineno-58-81"></a>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span>
</span><span id="__span-58-82"><a id="__codelineno-58-82" name="__codelineno-58-82" href="#__codelineno-58-82"></a>            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-58-83"><a id="__codelineno-58-83" name="__codelineno-58-83" href="#__codelineno-58-83"></a>        <span class="p">)</span>
</span><span id="__span-58-84"><a id="__codelineno-58-84" name="__codelineno-58-84" href="#__codelineno-58-84"></a>        
</span><span id="__span-58-85"><a id="__codelineno-58-85" name="__codelineno-58-85" href="#__codelineno-58-85"></a>        <span class="c1"># Calculate anomaly score</span>
</span><span id="__span-58-86"><a id="__codelineno-58-86" name="__codelineno-58-86" href="#__codelineno-58-86"></a>        <span class="n">anomaly_score</span> <span class="o">=</span> <span class="n">calculate_admin_anomaly_score</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-58-87"><a id="__codelineno-58-87" name="__codelineno-58-87" href="#__codelineno-58-87"></a>        
</span><span id="__span-58-88"><a id="__codelineno-58-88" name="__codelineno-58-88" href="#__codelineno-58-88"></a>        <span class="n">admin_insights</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-58-89"><a id="__codelineno-58-89" name="__codelineno-58-89" href="#__codelineno-58-89"></a>            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
</span><span id="__span-58-90"><a id="__codelineno-58-90" name="__codelineno-58-90" href="#__codelineno-58-90"></a>            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="__span-58-91"><a id="__codelineno-58-91" name="__codelineno-58-91" href="#__codelineno-58-91"></a>            <span class="s1">&#39;anomaly_score&#39;</span><span class="p">:</span> <span class="n">anomaly_score</span>
</span><span id="__span-58-92"><a id="__codelineno-58-92" name="__codelineno-58-92" href="#__codelineno-58-92"></a>        <span class="p">})</span>
</span><span id="__span-58-93"><a id="__codelineno-58-93" name="__codelineno-58-93" href="#__codelineno-58-93"></a>    
</span><span id="__span-58-94"><a id="__codelineno-58-94" name="__codelineno-58-94" href="#__codelineno-58-94"></a>    <span class="c1"># Sort by anomaly score</span>
</span><span id="__span-58-95"><a id="__codelineno-58-95" name="__codelineno-58-95" href="#__codelineno-58-95"></a>    <span class="n">admin_insights</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-58-96"><a id="__codelineno-58-96" name="__codelineno-58-96" href="#__codelineno-58-96"></a>    
</span><span id="__span-58-97"><a id="__codelineno-58-97" name="__codelineno-58-97" href="#__codelineno-58-97"></a>    <span class="k">return</span> <span class="n">admin_insights</span>
</span><span id="__span-58-98"><a id="__codelineno-58-98" name="__codelineno-58-98" href="#__codelineno-58-98"></a>
</span><span id="__span-58-99"><a id="__codelineno-58-99" name="__codelineno-58-99" href="#__codelineno-58-99"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_critical_admin_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
</span><span id="__span-58-100"><a id="__codelineno-58-100" name="__codelineno-58-100" href="#__codelineno-58-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if an admin event is critical&quot;&quot;&quot;</span>
</span><span id="__span-58-101"><a id="__codelineno-58-101" name="__codelineno-58-101" href="#__codelineno-58-101"></a>    <span class="n">critical_event_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-58-102"><a id="__codelineno-58-102" name="__codelineno-58-102" href="#__codelineno-58-102"></a>        <span class="s1">&#39;GRANT_ADMIN_PRIVILEGE&#39;</span><span class="p">,</span>
</span><span id="__span-58-103"><a id="__codelineno-58-103" name="__codelineno-58-103" href="#__codelineno-58-103"></a>        <span class="s1">&#39;CREATE_ROLE&#39;</span><span class="p">,</span>
</span><span id="__span-58-104"><a id="__codelineno-58-104" name="__codelineno-58-104" href="#__codelineno-58-104"></a>        <span class="s1">&#39;CHANGE_ROLE_SCOPE&#39;</span><span class="p">,</span>
</span><span id="__span-58-105"><a id="__codelineno-58-105" name="__codelineno-58-105" href="#__codelineno-58-105"></a>        <span class="s1">&#39;ADD_ROLE_PRIVILEGE&#39;</span><span class="p">,</span>
</span><span id="__span-58-106"><a id="__codelineno-58-106" name="__codelineno-58-106" href="#__codelineno-58-106"></a>        <span class="s1">&#39;CREATE_USER&#39;</span><span class="p">,</span>
</span><span id="__span-58-107"><a id="__codelineno-58-107" name="__codelineno-58-107" href="#__codelineno-58-107"></a>        <span class="s1">&#39;CHANGE_USER_PASSWORD&#39;</span><span class="p">,</span>
</span><span id="__span-58-108"><a id="__codelineno-58-108" name="__codelineno-58-108" href="#__codelineno-58-108"></a>        <span class="s1">&#39;TOGGLE_SERVICE_ACCOUNT&#39;</span><span class="p">,</span>
</span><span id="__span-58-109"><a id="__codelineno-58-109" name="__codelineno-58-109" href="#__codelineno-58-109"></a>        <span class="s1">&#39;ADD_SERVICE_ACCOUNT_PRIVILEGE&#39;</span><span class="p">,</span>
</span><span id="__span-58-110"><a id="__codelineno-58-110" name="__codelineno-58-110" href="#__codelineno-58-110"></a>        <span class="s1">&#39;CHANGE_TWO_STEP_VERIFICATION&#39;</span><span class="p">,</span>
</span><span id="__span-58-111"><a id="__codelineno-58-111" name="__codelineno-58-111" href="#__codelineno-58-111"></a>        <span class="s1">&#39;CHANGE_RECOVERY_EMAIL&#39;</span><span class="p">,</span>
</span><span id="__span-58-112"><a id="__codelineno-58-112" name="__codelineno-58-112" href="#__codelineno-58-112"></a>        <span class="s1">&#39;CHANGE_RECOVERY_PHONE&#39;</span>
</span><span id="__span-58-113"><a id="__codelineno-58-113" name="__codelineno-58-113" href="#__codelineno-58-113"></a>    <span class="p">]</span>
</span><span id="__span-58-114"><a id="__codelineno-58-114" name="__codelineno-58-114" href="#__codelineno-58-114"></a>    
</span><span id="__span-58-115"><a id="__codelineno-58-115" name="__codelineno-58-115" href="#__codelineno-58-115"></a>    <span class="n">event_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="__span-58-116"><a id="__codelineno-58-116" name="__codelineno-58-116" href="#__codelineno-58-116"></a>    <span class="k">return</span> <span class="n">event_name</span> <span class="ow">in</span> <span class="n">critical_event_types</span>
</span><span id="__span-58-117"><a id="__codelineno-58-117" name="__codelineno-58-117" href="#__codelineno-58-117"></a>
</span><span id="__span-58-118"><a id="__codelineno-58-118" name="__codelineno-58-118" href="#__codelineno-58-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_event_details</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
</span><span id="__span-58-119"><a id="__codelineno-58-119" name="__codelineno-58-119" href="#__codelineno-58-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract important details from an event&quot;&quot;&quot;</span>
</span><span id="__span-58-120"><a id="__codelineno-58-120" name="__codelineno-58-120" href="#__codelineno-58-120"></a>    <span class="n">details</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-58-121"><a id="__codelineno-58-121" name="__codelineno-58-121" href="#__codelineno-58-121"></a>    <span class="n">parameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-58-122"><a id="__codelineno-58-122" name="__codelineno-58-122" href="#__codelineno-58-122"></a>    
</span><span id="__span-58-123"><a id="__codelineno-58-123" name="__codelineno-58-123" href="#__codelineno-58-123"></a>    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span id="__span-58-124"><a id="__codelineno-58-124" name="__codelineno-58-124" href="#__codelineno-58-124"></a>        <span class="n">details</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span><span id="__span-58-125"><a id="__codelineno-58-125" name="__codelineno-58-125" href="#__codelineno-58-125"></a>    
</span><span id="__span-58-126"><a id="__codelineno-58-126" name="__codelineno-58-126" href="#__codelineno-58-126"></a>    <span class="k">return</span> <span class="n">details</span>
</span><span id="__span-58-127"><a id="__codelineno-58-127" name="__codelineno-58-127" href="#__codelineno-58-127"></a>
</span><span id="__span-58-128"><a id="__codelineno-58-128" name="__codelineno-58-128" href="#__codelineno-58-128"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_work_hours_percentage</span><span class="p">(</span><span class="n">timestamps</span><span class="p">):</span>
</span><span id="__span-58-129"><a id="__codelineno-58-129" name="__codelineno-58-129" href="#__codelineno-58-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate percentage of access during work hours (8AM-6PM local time)&quot;&quot;&quot;</span>
</span><span id="__span-58-130"><a id="__codelineno-58-130" name="__codelineno-58-130" href="#__codelineno-58-130"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">timestamps</span><span class="p">:</span>
</span><span id="__span-58-131"><a id="__codelineno-58-131" name="__codelineno-58-131" href="#__codelineno-58-131"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-58-132"><a id="__codelineno-58-132" name="__codelineno-58-132" href="#__codelineno-58-132"></a>        
</span><span id="__span-58-133"><a id="__codelineno-58-133" name="__codelineno-58-133" href="#__codelineno-58-133"></a>    <span class="n">work_hours_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-58-134"><a id="__codelineno-58-134" name="__codelineno-58-134" href="#__codelineno-58-134"></a>    
</span><span id="__span-58-135"><a id="__codelineno-58-135" name="__codelineno-58-135" href="#__codelineno-58-135"></a>    <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
</span><span id="__span-58-136"><a id="__codelineno-58-136" name="__codelineno-58-136" href="#__codelineno-58-136"></a>        <span class="c1"># Convert to datetime object</span>
</span><span id="__span-58-137"><a id="__codelineno-58-137" name="__codelineno-58-137" href="#__codelineno-58-137"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-138"><a id="__codelineno-58-138" name="__codelineno-58-138" href="#__codelineno-58-138"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
</span><span id="__span-58-139"><a id="__codelineno-58-139" name="__codelineno-58-139" href="#__codelineno-58-139"></a>            <span class="c1"># Check if access is during work hours (8AM-6PM local time, assuming UTC)</span>
</span><span id="__span-58-140"><a id="__codelineno-58-140" name="__codelineno-58-140" href="#__codelineno-58-140"></a>            <span class="n">hour</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
</span><span id="__span-58-141"><a id="__codelineno-58-141" name="__codelineno-58-141" href="#__codelineno-58-141"></a>            <span class="k">if</span> <span class="mi">8</span> <span class="o">&lt;=</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">18</span> <span class="ow">and</span> <span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Weekday and work hours</span>
</span><span id="__span-58-142"><a id="__codelineno-58-142" name="__codelineno-58-142" href="#__codelineno-58-142"></a>                <span class="n">work_hours_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-58-143"><a id="__codelineno-58-143" name="__codelineno-58-143" href="#__codelineno-58-143"></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="__span-58-144"><a id="__codelineno-58-144" name="__codelineno-58-144" href="#__codelineno-58-144"></a>            <span class="k">pass</span>
</span><span id="__span-58-145"><a id="__codelineno-58-145" name="__codelineno-58-145" href="#__codelineno-58-145"></a>    
</span><span id="__span-58-146"><a id="__codelineno-58-146" name="__codelineno-58-146" href="#__codelineno-58-146"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">work_hours_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="__span-58-147"><a id="__codelineno-58-147" name="__codelineno-58-147" href="#__codelineno-58-147"></a>
</span><span id="__span-58-148"><a id="__codelineno-58-148" name="__codelineno-58-148" href="#__codelineno-58-148"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_admin_anomaly_score</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-58-149"><a id="__codelineno-58-149" name="__codelineno-58-149" href="#__codelineno-58-149"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate an anomaly score for admin activity&quot;&quot;&quot;</span>
</span><span id="__span-58-150"><a id="__codelineno-58-150" name="__codelineno-58-150" href="#__codelineno-58-150"></a>    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-58-151"><a id="__codelineno-58-151" name="__codelineno-58-151" href="#__codelineno-58-151"></a>    
</span><span id="__span-58-152"><a id="__codelineno-58-152" name="__codelineno-58-152" href="#__codelineno-58-152"></a>    <span class="c1"># Multiple IPs increases risk</span>
</span><span id="__span-58-153"><a id="__codelineno-58-153" name="__codelineno-58-153" href="#__codelineno-58-153"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-58-154"><a id="__codelineno-58-154" name="__codelineno-58-154" href="#__codelineno-58-154"></a>        <span class="n">score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_count&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-58-155"><a id="__codelineno-58-155" name="__codelineno-58-155" href="#__codelineno-58-155"></a>    
</span><span id="__span-58-156"><a id="__codelineno-58-156" name="__codelineno-58-156" href="#__codelineno-58-156"></a>    <span class="c1"># Low work hours percentage is suspicious</span>
</span><span id="__span-58-157"><a id="__codelineno-58-157" name="__codelineno-58-157" href="#__codelineno-58-157"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;work_hours_percentage&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
</span><span id="__span-58-158"><a id="__codelineno-58-158" name="__codelineno-58-158" href="#__codelineno-58-158"></a>        <span class="n">score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">((</span><span class="mi">70</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;work_hours_percentage&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-58-159"><a id="__codelineno-58-159" name="__codelineno-58-159" href="#__codelineno-58-159"></a>    
</span><span id="__span-58-160"><a id="__codelineno-58-160" name="__codelineno-58-160" href="#__codelineno-58-160"></a>    <span class="c1"># Critical events increase risk significantly</span>
</span><span id="__span-58-161"><a id="__codelineno-58-161" name="__codelineno-58-161" href="#__codelineno-58-161"></a>    <span class="n">score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;critical_events&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-58-162"><a id="__codelineno-58-162" name="__codelineno-58-162" href="#__codelineno-58-162"></a>    
</span><span id="__span-58-163"><a id="__codelineno-58-163" name="__codelineno-58-163" href="#__codelineno-58-163"></a>    <span class="k">return</span> <span class="n">score</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Critical Configuration Change Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Admin
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>- Focus on security setting changes
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>- Check authentication configuration modifications
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>- Review API and service account changes
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>- Verify email routing configuration changes
</span></code></pre></div></p>
</li>
<li>
<p><strong>Evidence Collection</strong></p>
</li>
<li>Document all suspicious admin activities</li>
<li>Capture screenshots of admin console logs</li>
<li>Create timeline of privilege escalation events</li>
<li>Preserve original audit logs for investigation</li>
</ol>
<h3 id="containment-procedures_3">Containment Procedures<a class="headerlink" href="#containment-procedures_3" title="Permanent link">&para;</a></h3>
<p><strong>Immediate Actions:</strong></p>
<ol>
<li>
<p><strong>Admin Account Security</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Admin Console &gt; Directory &gt; Users
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>- Suspend suspected compromised admin accounts
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>- Reset passwords for all admin accounts
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>- Force logout of all admin sessions
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>- Enable stringent login challenges
</span></code></pre></div></p>
</li>
<li>
<p><strong>Role Assignment Review and Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>- Remove unauthorized role assignments
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>- Restrict available admin roles temporarily
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>- Implement emergency admin access limitations
</span></code></pre></div></p>
</li>
<li>
<p><strong>Critical Function Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a># Various Admin Console settings
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>- Disable user creation temporarily
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>- Restrict organization unit modifications
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>- Limit API access and integrations
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>- Disable service account creation
</span></code></pre></div></p>
</li>
<li>
<p><strong>Secure Super Admin Access</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>Admin Console &gt; Account &gt; Account settings
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>- Verify super admin accounts
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>- Implement IP restrictions for admin access
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>- Enable advanced protection for super admins
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>- Add additional verification layers
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Secondary Containment:</strong></p>
<ol>
<li>
<p><strong>Admin Console Access Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>Admin Console &gt; Security &gt; Access and data control &gt; Context-aware access
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>- Implement IP-based restrictions for Admin Console
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>- Configure device-based access requirements
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>- Deploy stepped-up authentication for admin actions
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Access Limitation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>- Restrict administrative API capabilities
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>- Review and reduce domain-wide delegations
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>- Implement strict API monitoring
</span></code></pre></div></p>
</li>
<li>
<p><strong>Delegated Administration Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>- Review all delegated admin roles
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>- Reduce privileges to minimum required
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>- Implement time-bound delegations
</span></code></pre></div></p>
</li>
</ol>
<h3 id="eradication-steps_3">Eradication Steps<a class="headerlink" href="#eradication-steps_3" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Remove Unauthorized Access</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>- Remove all unauthorized role assignments
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>- Delete suspicious admin accounts
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>- Reset all admin role configurations
</span></code></pre></div></p>
</li>
<li>
<p><strong>Revert Unauthorized Changes</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a># Based on impact assessment
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>- Restore security settings to known good state
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>- Revert unauthorized configuration changes
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>- Reset API access controls
</span></code></pre></div></p>
</li>
<li>
<p><strong>Rebuild Admin Structure</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>- Recreate admin roles with appropriate permissions
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>- Implement least privilege principle
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>- Establish role hierarchy with appropriate constraints
</span></code></pre></div></p>
</li>
<li>
<p><strong>Clean Up Persistent Access</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>- Remove unauthorized API access
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>- Revoke compromised service account credentials
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>- Delete unauthorized domain-wide delegations
</span></code></pre></div></p>
</li>
</ol>
<h3 id="recovery-guidance_3">Recovery Guidance<a class="headerlink" href="#recovery-guidance_3" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Admin Access Restoration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>Admin Console &gt; Account &gt; Admin roles
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>- Restore essential admin roles
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>- Configure appropriate role assignments
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>- Implement enhanced monitoring for admin actions
</span></code></pre></div></p>
</li>
<li>
<p><strong>Admin Privilege Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a># Various Admin Console settings
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>- Implement time-based access controls
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>- Configure location-based restrictions
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>- Deploy task-based privilege assignment
</span></code></pre></div></p>
</li>
<li>
<p><strong>Multi-Party Authorization Implementation</strong></p>
</li>
<li>Develop multi-admin approval for critical changes</li>
<li>Create change management processes</li>
<li>Implement administrative separation of duties</li>
<li>
<p>Establish emergency access procedures</p>
</li>
<li>
<p><strong>Enhanced Monitoring Deployment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>Admin Console &gt; Reports &gt; Audit
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>- Configure comprehensive admin activity alerts
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>- Implement baseline behavior monitoring
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>- Deploy anomaly detection for admin access
</span></code></pre></div></p>
</li>
</ol>
<h3 id="post-incident-analysis_3">Post-Incident Analysis<a class="headerlink" href="#post-incident-analysis_3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Admin Access Impact Assessment</strong></li>
<li>Document unauthorized admin actions</li>
<li>Assess impact of configuration changes</li>
<li>Determine potential data access or exposure</li>
<li>
<p>Evaluate regulatory compliance implications</p>
</li>
<li>
<p><strong>Admin Security Control Evaluation</strong></p>
</li>
<li>Review administrative access controls</li>
<li>Assess privilege management practices</li>
<li>Evaluate separation of duties implementation</li>
<li>
<p>Identify security control gaps</p>
</li>
<li>
<p><strong>Documentation and Reporting</strong></p>
</li>
<li>Create comprehensive incident timeline</li>
<li>Document security recommendations</li>
<li>Prepare executive summary</li>
<li>
<p>Develop admin security roadmap</p>
</li>
<li>
<p><strong>Security Enhancement Implementation</strong></p>
</li>
<li>Deploy enhanced admin access controls</li>
<li>Implement comprehensive audit procedures</li>
<li>Establish admin baseline behavior profiles</li>
<li>Create admin security verification processes</li>
</ol>
<h2 id="malicious-application-installation-incident-response">Malicious Application Installation Incident Response<a class="headerlink" href="#malicious-application-installation-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="incident-overview_4">Incident Overview<a class="headerlink" href="#incident-overview_4" title="Permanent link">&para;</a></h3>
<p><strong>Description:</strong><br />
Installation of unauthorized, malicious, or excessively permissioned applications in the Google Workspace environment, potentially resulting in data exposure, credential theft, or persistent unauthorized access.</p>
<p><strong>Common Attack Vectors:</strong>
- Malicious Marketplace applications
- Phishing campaigns for application authorization
- Third-party applications with excessive permissions
- Rogue browser extensions with Workspace access
- Malicious Apps Script implementations
- OAuth phishing for application installation</p>
<p><strong>Severity Classifications:</strong>
- <strong>Critical</strong>: Admin-level application with widespread deployment
- <strong>High</strong>: Data access application with significant adoption
- <strong>Medium</strong>: Limited access application with targeted deployment
- <strong>Low</strong>: Minimal risk application with restricted permissions</p>
<h3 id="detection-and-analysis_4">Detection and Analysis<a class="headerlink" href="#detection-and-analysis_4" title="Permanent link">&para;</a></h3>
<p><strong>Initial Indicators:</strong>
- Unusual application installation patterns
- Applications requesting excessive permissions
- User reports of suspicious OAuth requests
- Unexpected data access or sharing
- Abnormal API usage from applications
- Unusual Chrome extension behavior</p>
<p><strong>Investigation Procedures:</strong></p>
<ol>
<li>
<p><strong>Application Inventory Analysis</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>- Review recently installed applications
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>- Identify applications with unusual permission scopes
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>- Check for applications with admin access
</span></code></pre></div></p>
</li>
<li>
<p><strong>OAuth Token Activity Review</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>Admin Console &gt; Reports &gt; Audit &gt; Token
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>- Analyze token usage patterns
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>- Identify applications with unusual activity
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>- Check for suspicious permission requests
</span></code></pre></div></p>
</li>
<li>
<p><strong>Marketplace Application Assessment</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>Admin Console &gt; Apps &gt; Marketplace apps
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>- Review recently installed applications
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>- Check for unauthorized deployment patterns
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>- Identify suspicious application behavior
</span></code></pre></div></p>
</li>
<li>
<p><strong>Chrome Extension Inventory</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>Admin Console &gt; Devices &gt; Chrome &gt; Apps &amp; extensions
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>- Review installed extensions
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>- Check for extensions with unusual permissions
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>- Identify extensions with Workspace access
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Behavior Analysis</strong>
   <div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># Python script to analyze application behavior for anomalies</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_application_behavior</span><span class="p">(</span><span class="n">reports_service</span><span class="p">,</span> <span class="n">days_back</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze application behavior for suspicious patterns&quot;&quot;&quot;</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>    <span class="c1"># Calculate start time</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_back</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>    
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>    <span class="c1"># Get application activities</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>    <span class="n">app_events</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>    
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a>    <span class="c1"># Check various application types</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>    <span class="k">for</span> <span class="n">app_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span><span class="p">]:</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>        <span class="n">events</span> <span class="o">=</span> <span class="n">reports_service</span><span class="o">.</span><span class="n">activities</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>            <span class="n">userKey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>            <span class="n">applicationName</span><span class="o">=</span><span class="n">app_type</span><span class="p">,</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>            <span class="n">startTime</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a>            <span class="n">maxResults</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>        <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a>        
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>        <span class="n">app_events</span><span class="p">[</span><span class="n">app_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a>    
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a>    <span class="c1"># Analyze OAuth application behavior</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a>    <span class="n">oauth_apps</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a>    
</span><span id="__span-78-24"><a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a>    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">app_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="__span-78-25"><a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a>        <span class="c1"># Extract application details</span>
</span><span id="__span-78-26"><a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-78-27"><a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a>        <span class="n">client_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;client_id&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-78-28"><a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a>        <span class="n">app_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;app_name&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-78-29"><a id="__codelineno-78-29" name="__codelineno-78-29" href="#__codelineno-78-29"></a>        <span class="n">scopes</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;scope&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="__span-78-30"><a id="__codelineno-78-30" name="__codelineno-78-30" href="#__codelineno-78-30"></a>        <span class="n">user</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;actor&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</span><span id="__span-78-31"><a id="__codelineno-78-31" name="__codelineno-78-31" href="#__codelineno-78-31"></a>        
</span><span id="__span-78-32"><a id="__codelineno-78-32" name="__codelineno-78-32" href="#__codelineno-78-32"></a>        <span class="c1"># Create app entry if needed</span>
</span><span id="__span-78-33"><a id="__codelineno-78-33" name="__codelineno-78-33" href="#__codelineno-78-33"></a>        <span class="n">app_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-78-34"><a id="__codelineno-78-34" name="__codelineno-78-34" href="#__codelineno-78-34"></a>        <span class="k">if</span> <span class="n">app_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oauth_apps</span><span class="p">:</span>
</span><span id="__span-78-35"><a id="__codelineno-78-35" name="__codelineno-78-35" href="#__codelineno-78-35"></a>            <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-78-36"><a id="__codelineno-78-36" name="__codelineno-78-36" href="#__codelineno-78-36"></a>                <span class="s1">&#39;app_name&#39;</span><span class="p">:</span> <span class="n">app_name</span><span class="p">,</span>
</span><span id="__span-78-37"><a id="__codelineno-78-37" name="__codelineno-78-37" href="#__codelineno-78-37"></a>                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span>
</span><span id="__span-78-38"><a id="__codelineno-78-38" name="__codelineno-78-38" href="#__codelineno-78-38"></a>                <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-78-39"><a id="__codelineno-78-39" name="__codelineno-78-39" href="#__codelineno-78-39"></a>                <span class="s1">&#39;scopes&#39;</span><span class="p">:</span> <span class="n">scopes</span><span class="p">,</span>
</span><span id="__span-78-40"><a id="__codelineno-78-40" name="__codelineno-78-40" href="#__codelineno-78-40"></a>                <span class="s1">&#39;scope_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">scopes</span><span class="p">),</span>
</span><span id="__span-78-41"><a id="__codelineno-78-41" name="__codelineno-78-41" href="#__codelineno-78-41"></a>                <span class="s1">&#39;high_risk_scopes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scopes</span> <span class="k">if</span> <span class="n">is_high_risk_scope</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span>
</span><span id="__span-78-42"><a id="__codelineno-78-42" name="__codelineno-78-42" href="#__codelineno-78-42"></a>                <span class="s1">&#39;ip_addresses&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span id="__span-78-43"><a id="__codelineno-78-43" name="__codelineno-78-43" href="#__codelineno-78-43"></a>                <span class="s1">&#39;access_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-78-44"><a id="__codelineno-78-44" name="__codelineno-78-44" href="#__codelineno-78-44"></a>                <span class="s1">&#39;first_seen&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
</span><span id="__span-78-45"><a id="__codelineno-78-45" name="__codelineno-78-45" href="#__codelineno-78-45"></a>                <span class="s1">&#39;last_seen&#39;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</span><span id="__span-78-46"><a id="__codelineno-78-46" name="__codelineno-78-46" href="#__codelineno-78-46"></a>            <span class="p">}</span>
</span><span id="__span-78-47"><a id="__codelineno-78-47" name="__codelineno-78-47" href="#__codelineno-78-47"></a>        
</span><span id="__span-78-48"><a id="__codelineno-78-48" name="__codelineno-78-48" href="#__codelineno-78-48"></a>        <span class="c1"># Update app data</span>
</span><span id="__span-78-49"><a id="__codelineno-78-49" name="__codelineno-78-49" href="#__codelineno-78-49"></a>        <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-78-50"><a id="__codelineno-78-50" name="__codelineno-78-50" href="#__codelineno-78-50"></a>        <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;access_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-78-51"><a id="__codelineno-78-51" name="__codelineno-78-51" href="#__codelineno-78-51"></a>        
</span><span id="__span-78-52"><a id="__codelineno-78-52" name="__codelineno-78-52" href="#__codelineno-78-52"></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">):</span>
</span><span id="__span-78-53"><a id="__codelineno-78-53" name="__codelineno-78-53" href="#__codelineno-78-53"></a>            <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">))</span>
</span><span id="__span-78-54"><a id="__codelineno-78-54" name="__codelineno-78-54" href="#__codelineno-78-54"></a>        
</span><span id="__span-78-55"><a id="__codelineno-78-55" name="__codelineno-78-55" href="#__codelineno-78-55"></a>        <span class="c1"># Update time range</span>
</span><span id="__span-78-56"><a id="__codelineno-78-56" name="__codelineno-78-56" href="#__codelineno-78-56"></a>        <span class="n">event_time</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</span><span id="__span-78-57"><a id="__codelineno-78-57" name="__codelineno-78-57" href="#__codelineno-78-57"></a>        <span class="k">if</span> <span class="n">event_time</span> <span class="o">&lt;</span> <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;first_seen&#39;</span><span class="p">]:</span>
</span><span id="__span-78-58"><a id="__codelineno-78-58" name="__codelineno-78-58" href="#__codelineno-78-58"></a>            <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;first_seen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_time</span>
</span><span id="__span-78-59"><a id="__codelineno-78-59" name="__codelineno-78-59" href="#__codelineno-78-59"></a>        <span class="k">if</span> <span class="n">event_time</span> <span class="o">&gt;</span> <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]:</span>
</span><span id="__span-78-60"><a id="__codelineno-78-60" name="__codelineno-78-60" href="#__codelineno-78-60"></a>            <span class="n">oauth_apps</span><span class="p">[</span><span class="n">app_key</span><span class="p">][</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_time</span>
</span><span id="__span-78-61"><a id="__codelineno-78-61" name="__codelineno-78-61" href="#__codelineno-78-61"></a>    
</span><span id="__span-78-62"><a id="__codelineno-78-62" name="__codelineno-78-62" href="#__codelineno-78-62"></a>    <span class="c1"># Process data for analysis</span>
</span><span id="__span-78-63"><a id="__codelineno-78-63" name="__codelineno-78-63" href="#__codelineno-78-63"></a>    <span class="n">app_analysis</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-78-64"><a id="__codelineno-78-64" name="__codelineno-78-64" href="#__codelineno-78-64"></a>    
</span><span id="__span-78-65"><a id="__codelineno-78-65" name="__codelineno-78-65" href="#__codelineno-78-65"></a>    <span class="k">for</span> <span class="n">app_key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">oauth_apps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-78-66"><a id="__codelineno-78-66" name="__codelineno-78-66" href="#__codelineno-78-66"></a>        <span class="c1"># Convert sets to counts</span>
</span><span id="__span-78-67"><a id="__codelineno-78-67" name="__codelineno-78-67" href="#__codelineno-78-67"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">])</span>
</span><span id="__span-78-68"><a id="__codelineno-78-68" name="__codelineno-78-68" href="#__codelineno-78-68"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;unique_ips&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-78-69"><a id="__codelineno-78-69" name="__codelineno-78-69" href="#__codelineno-78-69"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">])</span>
</span><span id="__span-78-70"><a id="__codelineno-78-70" name="__codelineno-78-70" href="#__codelineno-78-70"></a>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;user_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">])</span>
</span><span id="__span-78-71"><a id="__codelineno-78-71" name="__codelineno-78-71" href="#__codelineno-78-71"></a>        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip_addresses&#39;</span><span class="p">]</span>
</span><span id="__span-78-72"><a id="__codelineno-78-72" name="__codelineno-78-72" href="#__codelineno-78-72"></a>        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span>
</span><span id="__span-78-73"><a id="__codelineno-78-73" name="__codelineno-78-73" href="#__codelineno-78-73"></a>        
</span><span id="__span-78-74"><a id="__codelineno-78-74" name="__codelineno-78-74" href="#__codelineno-78-74"></a>        <span class="c1"># Calculate risk score</span>
</span><span id="__span-78-75"><a id="__codelineno-78-75" name="__codelineno-78-75" href="#__codelineno-78-75"></a>        <span class="n">risk_score</span> <span class="o">=</span> <span class="n">calculate_app_risk_score</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-78-76"><a id="__codelineno-78-76" name="__codelineno-78-76" href="#__codelineno-78-76"></a>        
</span><span id="__span-78-77"><a id="__codelineno-78-77" name="__codelineno-78-77" href="#__codelineno-78-77"></a>        <span class="n">app_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-78-78"><a id="__codelineno-78-78" name="__codelineno-78-78" href="#__codelineno-78-78"></a>            <span class="s1">&#39;app_key&#39;</span><span class="p">:</span> <span class="n">app_key</span><span class="p">,</span>
</span><span id="__span-78-79"><a id="__codelineno-78-79" name="__codelineno-78-79" href="#__codelineno-78-79"></a>            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="__span-78-80"><a id="__codelineno-78-80" name="__codelineno-78-80" href="#__codelineno-78-80"></a>            <span class="s1">&#39;risk_score&#39;</span><span class="p">:</span> <span class="n">risk_score</span>
</span><span id="__span-78-81"><a id="__codelineno-78-81" name="__codelineno-78-81" href="#__codelineno-78-81"></a>        <span class="p">})</span>
</span><span id="__span-78-82"><a id="__codelineno-78-82" name="__codelineno-78-82" href="#__codelineno-78-82"></a>    
</span><span id="__span-78-83"><a id="__codelineno-78-83" name="__codelineno-78-83" href="#__codelineno-78-83"></a>    <span class="c1"># Sort by risk score</span>
</span><span id="__span-78-84"><a id="__codelineno-78-84" name="__codelineno-78-84" href="#__codelineno-78-84"></a>    <span class="n">app_analysis</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;risk_score&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-78-85"><a id="__codelineno-78-85" name="__codelineno-78-85" href="#__codelineno-78-85"></a>    
</span><span id="__span-78-86"><a id="__codelineno-78-86" name="__codelineno-78-86" href="#__codelineno-78-86"></a>    <span class="k">return</span> <span class="n">app_analysis</span>
</span><span id="__span-78-87"><a id="__codelineno-78-87" name="__codelineno-78-87" href="#__codelineno-78-87"></a>
</span><span id="__span-78-88"><a id="__codelineno-78-88" name="__codelineno-78-88" href="#__codelineno-78-88"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_high_risk_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span><span id="__span-78-89"><a id="__codelineno-78-89" name="__codelineno-78-89" href="#__codelineno-78-89"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a scope is high-risk&quot;&quot;&quot;</span>
</span><span id="__span-78-90"><a id="__codelineno-78-90" name="__codelineno-78-90" href="#__codelineno-78-90"></a>    <span class="n">high_risk_indicators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-78-91"><a id="__codelineno-78-91" name="__codelineno-78-91" href="#__codelineno-78-91"></a>        <span class="s1">&#39;https://mail.google.com/&#39;</span><span class="p">,</span>
</span><span id="__span-78-92"><a id="__codelineno-78-92" name="__codelineno-78-92" href="#__codelineno-78-92"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">,</span>
</span><span id="__span-78-93"><a id="__codelineno-78-93" name="__codelineno-78-93" href="#__codelineno-78-93"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/admin&#39;</span><span class="p">,</span>
</span><span id="__span-78-94"><a id="__codelineno-78-94" name="__codelineno-78-94" href="#__codelineno-78-94"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/cloud-platform&#39;</span><span class="p">,</span>
</span><span id="__span-78-95"><a id="__codelineno-78-95" name="__codelineno-78-95" href="#__codelineno-78-95"></a>        <span class="s1">&#39;.readonly&#39;</span><span class="p">,</span>  <span class="c1"># Wildcard for read access to services</span>
</span><span id="__span-78-96"><a id="__codelineno-78-96" name="__codelineno-78-96" href="#__codelineno-78-96"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/contacts&#39;</span><span class="p">,</span>
</span><span id="__span-78-97"><a id="__codelineno-78-97" name="__codelineno-78-97" href="#__codelineno-78-97"></a>        <span class="s1">&#39;https://www.googleapis.com/auth/calendar&#39;</span>
</span><span id="__span-78-98"><a id="__codelineno-78-98" name="__codelineno-78-98" href="#__codelineno-78-98"></a>    <span class="p">]</span>
</span><span id="__span-78-99"><a id="__codelineno-78-99" name="__codelineno-78-99" href="#__codelineno-78-99"></a>    
</span><span id="__span-78-100"><a id="__codelineno-78-100" name="__codelineno-78-100" href="#__codelineno-78-100"></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">scope</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">high_risk_indicators</span><span class="p">)</span>
</span><span id="__span-78-101"><a id="__codelineno-78-101" name="__codelineno-78-101" href="#__codelineno-78-101"></a>
</span><span id="__span-78-102"><a id="__codelineno-78-102" name="__codelineno-78-102" href="#__codelineno-78-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_app_risk_score</span><span class="p">(</span><span class="n">app_data</span><span class="p">):</span>
</span><span id="__span-78-103"><a id="__codelineno-78-103" name="__codelineno-78-103" href="#__codelineno-78-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate risk score for an application&quot;&quot;&quot;</span>
</span><span id="__span-78-104"><a id="__codelineno-78-104" name="__codelineno-78-104" href="#__codelineno-78-104"></a>    <span class="n">risk_score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-78-105"><a id="__codelineno-78-105" name="__codelineno-78-105" href="#__codelineno-78-105"></a>    
</span><span id="__span-78-106"><a id="__codelineno-78-106" name="__codelineno-78-106" href="#__codelineno-78-106"></a>    <span class="c1"># More users = higher potential impact</span>
</span><span id="__span-78-107"><a id="__codelineno-78-107" name="__codelineno-78-107" href="#__codelineno-78-107"></a>    <span class="k">if</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="__span-78-108"><a id="__codelineno-78-108" name="__codelineno-78-108" href="#__codelineno-78-108"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">3</span>
</span><span id="__span-78-109"><a id="__codelineno-78-109" name="__codelineno-78-109" href="#__codelineno-78-109"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-78-110"><a id="__codelineno-78-110" name="__codelineno-78-110" href="#__codelineno-78-110"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-78-111"><a id="__codelineno-78-111" name="__codelineno-78-111" href="#__codelineno-78-111"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-78-112"><a id="__codelineno-78-112" name="__codelineno-78-112" href="#__codelineno-78-112"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-78-113"><a id="__codelineno-78-113" name="__codelineno-78-113" href="#__codelineno-78-113"></a>    
</span><span id="__span-78-114"><a id="__codelineno-78-114" name="__codelineno-78-114" href="#__codelineno-78-114"></a>    <span class="c1"># High number of scopes increases risk</span>
</span><span id="__span-78-115"><a id="__codelineno-78-115" name="__codelineno-78-115" href="#__codelineno-78-115"></a>    <span class="k">if</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-78-116"><a id="__codelineno-78-116" name="__codelineno-78-116" href="#__codelineno-78-116"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">3</span>
</span><span id="__span-78-117"><a id="__codelineno-78-117" name="__codelineno-78-117" href="#__codelineno-78-117"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-78-118"><a id="__codelineno-78-118" name="__codelineno-78-118" href="#__codelineno-78-118"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-78-119"><a id="__codelineno-78-119" name="__codelineno-78-119" href="#__codelineno-78-119"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;scope_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-78-120"><a id="__codelineno-78-120" name="__codelineno-78-120" href="#__codelineno-78-120"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-78-121"><a id="__codelineno-78-121" name="__codelineno-78-121" href="#__codelineno-78-121"></a>    
</span><span id="__span-78-122"><a id="__codelineno-78-122" name="__codelineno-78-122" href="#__codelineno-78-122"></a>    <span class="c1"># High-risk scopes significantly increase risk</span>
</span><span id="__span-78-123"><a id="__codelineno-78-123" name="__codelineno-78-123" href="#__codelineno-78-123"></a>    <span class="n">risk_score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;high_risk_scopes&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-78-124"><a id="__codelineno-78-124" name="__codelineno-78-124" href="#__codelineno-78-124"></a>    
</span><span id="__span-78-125"><a id="__codelineno-78-125" name="__codelineno-78-125" href="#__codelineno-78-125"></a>    <span class="c1"># Rapid adoption may indicate phishing campaign</span>
</span><span id="__span-78-126"><a id="__codelineno-78-126" name="__codelineno-78-126" href="#__codelineno-78-126"></a>    <span class="n">first_seen</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;first_seen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
</span><span id="__span-78-127"><a id="__codelineno-78-127" name="__codelineno-78-127" href="#__codelineno-78-127"></a>    <span class="n">last_seen</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;last_seen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
</span><span id="__span-78-128"><a id="__codelineno-78-128" name="__codelineno-78-128" href="#__codelineno-78-128"></a>    <span class="n">adoption_period</span> <span class="o">=</span> <span class="p">(</span><span class="n">last_seen</span> <span class="o">-</span> <span class="n">first_seen</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># hours</span>
</span><span id="__span-78-129"><a id="__codelineno-78-129" name="__codelineno-78-129" href="#__codelineno-78-129"></a>    
</span><span id="__span-78-130"><a id="__codelineno-78-130" name="__codelineno-78-130" href="#__codelineno-78-130"></a>    <span class="k">if</span> <span class="n">adoption_period</span> <span class="o">&lt;</span> <span class="mi">24</span> <span class="ow">and</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-78-131"><a id="__codelineno-78-131" name="__codelineno-78-131" href="#__codelineno-78-131"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>  <span class="c1"># Rapid adoption across multiple users</span>
</span><span id="__span-78-132"><a id="__codelineno-78-132" name="__codelineno-78-132" href="#__codelineno-78-132"></a>    
</span><span id="__span-78-133"><a id="__codelineno-78-133" name="__codelineno-78-133" href="#__codelineno-78-133"></a>    <span class="c1"># Multiple IP addresses may indicate broader usage or command &amp; control</span>
</span><span id="__span-78-134"><a id="__codelineno-78-134" name="__codelineno-78-134" href="#__codelineno-78-134"></a>    <span class="k">if</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;unique_ips&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-78-135"><a id="__codelineno-78-135" name="__codelineno-78-135" href="#__codelineno-78-135"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="__span-78-136"><a id="__codelineno-78-136" name="__codelineno-78-136" href="#__codelineno-78-136"></a>    <span class="k">elif</span> <span class="n">app_data</span><span class="p">[</span><span class="s1">&#39;unique_ips&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-78-137"><a id="__codelineno-78-137" name="__codelineno-78-137" href="#__codelineno-78-137"></a>        <span class="n">risk_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-78-138"><a id="__codelineno-78-138" name="__codelineno-78-138" href="#__codelineno-78-138"></a>    
</span><span id="__span-78-139"><a id="__codelineno-78-139" name="__codelineno-78-139" href="#__codelineno-78-139"></a>    <span class="k">return</span> <span class="n">risk_score</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Evidence Collection</strong></p>
</li>
<li>Document suspicious applications</li>
<li>Record affected users and scope of installation</li>
<li>Capture OAuth permission request details</li>
<li>Create timeline of application installation and usage</li>
</ol>
<h3 id="containment-procedures_4">Containment Procedures<a class="headerlink" href="#containment-procedures_4" title="Permanent link">&para;</a></h3>
<p><strong>Immediate Actions:</strong></p>
<ol>
<li>
<p><strong>Application Access Revocation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App access control
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>- Block suspicious applications
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>- Revoke tokens for malicious applications
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>- Restrict future authorization attempts
</span></code></pre></div></p>
</li>
<li>
<p><strong>Marketplace Application Restriction</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>Admin Console &gt; Apps &gt; Marketplace apps
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>- Remove suspicious applications
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>- Disable affected applications
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>- Block future installations
</span></code></pre></div></p>
</li>
<li>
<p><strong>Chrome Extension Management</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>Admin Console &gt; Devices &gt; Chrome &gt; Apps &amp; extensions
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>- Force remove malicious extensions
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>- Block installation of suspicious extensions
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>- Implement extension allowlisting
</span></code></pre></div></p>
</li>
<li>
<p><strong>Apps Script Management</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>Admin Console &gt; Security &gt; API Controls &gt; App Scripts
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>- Disable suspicious scripts
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>- Revoke excessive permissions
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>- Block unauthorized script execution
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Secondary Containment:</strong></p>
<ol>
<li>
<p><strong>API Access Limitation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>- Restrict available API scopes
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>- Implement more granular permissions
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>- Deploy enhanced API monitoring
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Installation Control</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>Admin Console &gt; Apps &gt; Marketplace apps
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>- Configure app installation restrictions
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>- Implement approval workflows
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>- Deploy application allowlisting
</span></code></pre></div></p>
</li>
<li>
<p><strong>User Communication</strong></p>
</li>
<li>Notify affected users of security incident</li>
<li>Provide application revocation instructions</li>
<li>Establish reporting procedures for suspicious apps</li>
<li>Deploy phishing awareness for application-based attacks</li>
</ol>
<h3 id="eradication-steps_4">Eradication Steps<a class="headerlink" href="#eradication-steps_4" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Comprehensive Application Removal</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a># Various Admin Console settings
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>- Remove all instances of malicious applications
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>- Revoke all associated OAuth tokens
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>- Block application client IDs permanently
</span></code></pre></div></p>
</li>
<li>
<p><strong>Permission Cleanup</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>- Review and reset excessive permissions
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>- Implement least privilege for applications
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>- Revoke unnecessary access rights
</span></code></pre></div></p>
</li>
<li>
<p><strong>Browser Extension Cleanup</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>Admin Console &gt; Devices &gt; Chrome &gt; Apps &amp; extensions
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>- Remove all instances of malicious extensions
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>- Implement comprehensive extension policies
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>- Deploy browser security baselines
</span></code></pre></div></p>
</li>
<li>
<p><strong>Apps Script Remediation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a># Via script inventory
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>- Identify and remove malicious scripts
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>- Audit trigger configurations
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>- Remove unauthorized script deployments
</span></code></pre></div></p>
</li>
</ol>
<h3 id="recovery-guidance_4">Recovery Guidance<a class="headerlink" href="#recovery-guidance_4" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Application Access Restoration</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a># For legitimate applications
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>- Restore access for approved applications
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>- Implement proper permission scoping
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>- Configure appropriate monitoring
</span></code></pre></div></p>
</li>
<li>
<p><strong>Application Control Implementation</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>Admin Console &gt; Apps &gt; Marketplace apps
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>- Deploy application allowlisting
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>- Implement installation approval workflows
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>- Configure appropriate access controls
</span></code></pre></div></p>
</li>
<li>
<p><strong>Extension Governance</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>Admin Console &gt; Devices &gt; Chrome &gt; Apps &amp; extensions
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>- Implement extension allowlisting
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>- Deploy extension risk assessment process
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>- Configure appropriate extension policies
</span></code></pre></div></p>
</li>
<li>
<p><strong>API Security Enhancement</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>Admin Console &gt; Security &gt; API Controls
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>- Implement enhanced API access controls
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>- Deploy comprehensive monitoring
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>- Configure scope limitations
</span></code></pre></div></p>
</li>
</ol>
<h3 id="post-incident-analysis_4">Post-Incident Analysis<a class="headerlink" href="#post-incident-analysis_4" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Application Impact Assessment</strong></li>
<li>Identify scope of application installation</li>
<li>Determine data access and potential exposure</li>
<li>Assess user impact and workflow disruption</li>
<li>
<p>Document affected systems and services</p>
</li>
<li>
<p><strong>Application Control Evaluation</strong></p>
</li>
<li>Review application governance processes</li>
<li>Assess installation control effectiveness</li>
<li>Evaluate permission management practices</li>
<li>
<p>Identify security control gaps</p>
</li>
<li>
<p><strong>Documentation and Reporting</strong></p>
</li>
<li>Create comprehensive incident timeline</li>
<li>Document affected applications and users</li>
<li>Prepare executive summary</li>
<li>
<p>Develop application security roadmap</p>
</li>
<li>
<p><strong>Security Enhancement Implementation</strong></p>
</li>
<li>Deploy application governance framework</li>
<li>Implement comprehensive vetting process</li>
<li>Establish application security baselines</li>
<li>Create continuous monitoring procedures</li>
</ol>
<h2 id="additional-resources-and-references">Additional Resources and References<a class="headerlink" href="#additional-resources-and-references" title="Permanent link">&para;</a></h2>
<h3 id="incident-response-documentation-templates">Incident Response Documentation Templates<a class="headerlink" href="#incident-response-documentation-templates" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Incident Response Report Template</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a># Google Workspace Security Incident Report
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>## Incident Overview
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>- Incident ID: [ID]
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>- Type: [Account Compromise, Data Exfiltration, OAuth Token Abuse, etc.]
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>- Severity: [Critical, High, Medium, Low]
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>- Date Detected: [Date]
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>- Date Contained: [Date]
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>- Date Resolved: [Date]
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>- Affected Users/Systems: [List]
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>## Incident Timeline
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>- [Date/Time] - [Event]
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>- [Date/Time] - [Event]
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a>- [Date/Time] - [Event]
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a>## Root Cause Analysis
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>- [Detailed analysis of how the incident occurred]
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a>## Impact Assessment
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>- [Description of impact on systems, users, and data]
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a>## Response Actions
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>- [Actions taken to contain, eradicate, and recover]
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a>## Lessons Learned
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a>- [Key takeaways and improvement opportunities]
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a>
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a>## Recommendations
</span><span id="__span-93-30"><a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a>- [Specific actions to prevent recurrence]
</span></code></pre></div></p>
</li>
<li>
<p><strong>Communication Templates</strong></p>
</li>
<li>User Notification Template</li>
<li>Executive Briefing Template</li>
<li>Technical Team Communication Template</li>
<li>Post-Incident Review Meeting Agenda</li>
</ol>
<h3 id="google-workspace-security-resources">Google Workspace Security Resources<a class="headerlink" href="#google-workspace-security-resources" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Official Google Documentation</strong></li>
<li><a href="https://workspace.google.com/security/">Google Workspace Security Center</a></li>
<li><a href="https://cloud.google.com/docs/security/best-practices">Google Security Best Practices</a></li>
<li>
<p><a href="https://support.google.com/a/topic/2683828">Google Admin Help: Security and privacy</a></p>
</li>
<li>
<p><strong>Security Frameworks and Standards</strong></p>
</li>
<li><a href="https://www.nist.gov/cyberframework">NIST Cybersecurity Framework</a></li>
<li><a href="https://www.sans.org/white-papers/incident-handlers-handbook/">SANS Incident Response Guide</a></li>
<li>
<p><a href="https://www.iso.org/isoiec-27001-information-security.html">ISO 27001 Information Security Management</a></p>
</li>
<li>
<p><strong>Regulatory Compliance Resources</strong></p>
</li>
<li><a href="https://gdpr.eu/">GDPR Compliance</a></li>
<li><a href="https://www.hhs.gov/hipaa/index.html">HIPAA Compliance</a></li>
<li><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r5.pdf">NIST 800-53 Controls</a></li>
</ol>
<hr />
<p><strong>Note</strong>: These playbooks should be adapted to your organization's specific Google Workspace configuration, security posture, and compliance requirements.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 1, 2025 02:13:27 UTC">June 1, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 1, 2025 02:13:27 UTC">June 1, 2025</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/ethanolivertroy" class="md-author" title="@ethanolivertroy">
          
          <img src="https://avatars.githubusercontent.com/u/63926014?v=4&size=72" alt="ethanolivertroy">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by <a href="https://github.com/ethanolivertroy/GWS-Security-Suite/issues/new/?title=[Feedback]+Incident%20Response%20Playbooks+-+/incident-response-playbooks/" target="_blank" rel="noopener">telling us what you're missing</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../google-groups-security/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Google Groups Security">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Google Groups Security
              </div>
            </div>
          </a>
        
        
          
          <a href="../log-analysis/" class="md-footer__link md-footer__link--next" aria-label="Next: Log Analysis">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Log Analysis
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ethanolivertroy/GWS-Security-Suite" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ethanolivertroy" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/ethanolivertroy" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.path", "navigation.top", "navigation.footer", "navigation.expand", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.code.select", "content.code.select.copy", "content.action.edit", "content.action.view", "content.action.feedback", "content.action.star", "content.action.issue", "content.authors", "content.contributors", "content.git", "content.footer", "content.source", "header.autohide"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": true, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>